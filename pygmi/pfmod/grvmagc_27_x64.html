<!DOCTYPE html>
<!-- Generated by Cython 0.20.1 on Mon May 12 14:22:06 2014 -->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">

body { font-family: courier; font-size: 12; }

.code  { font-size: 9; color: #444444; display: none; margin-left: 20px; }
.py_c_api  { color: red; }
.py_macro_api  { color: #FF7000; }
.pyx_c_api  { color: #FF3000; }
.pyx_macro_api  { color: #FF7000; }
.refnanny  { color: #FFA000; }

.error_goto  { color: #FFA000; }

.tag  {  }

.coerce  { color: #008000; border: 1px dotted #008000 }

.py_attr { color: #FF0000; font-weight: bold; }
.c_attr  { color: #0000FF; }

.py_call { color: #FF0000; font-weight: bold; }
.c_call  { color: #0000FF; }

.line { margin: 0em }

</style>
<script>
function toggleDiv(id) {
    theDiv = document.getElementById(id);
    if (theDiv.style.display != 'block') theDiv.style.display = 'block';
    else theDiv.style.display = 'none';
}
</script>
</head>
        <body>
<p>Generated by Cython 0.20.1 on Mon May 12 14:22:06 2014
<p>Raw output: <a href="grvmagc_27_x64.c">grvmagc_27_x64.c</a>
<pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1")'> 1: #------------------------------------------------------------------------------</pre>
<pre id='line1' class='code' style='background-color: #FFFF79'>  __pyx_t_2 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2")'> 2: # Name:        grvmagc.pyx (part of PyGMI)</pre>
<pre id='line2' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line3")'> 3: #</pre>
<pre id='line3' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line4")'> 4: # Author:      Patrick Cole</pre>
<pre id='line4' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line5")'> 5: # E-Mail:      pcole@geoscience.org.za</pre>
<pre id='line5' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line6")'> 6: #</pre>
<pre id='line6' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line7")'> 7: # Copyright:   (c) 2013 Council for Geoscience</pre>
<pre id='line7' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line8")'> 8: # Licence:     GPL-3.0</pre>
<pre id='line8' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line9")'> 9: #</pre>
<pre id='line9' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line10")'> 10: # This file is part of PyGMI</pre>
<pre id='line10' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line11")'> 11: #</pre>
<pre id='line11' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line12")'> 12: # PyGMI is free software: you can redistribute it and/or modify</pre>
<pre id='line12' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line13")'> 13: # it under the terms of the GNU General Public License as published by</pre>
<pre id='line13' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line14")'> 14: # the Free Software Foundation, either version 3 of the License, or</pre>
<pre id='line14' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line15")'> 15: # (at your option) any later version.</pre>
<pre id='line15' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line16")'> 16: #</pre>
<pre id='line16' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line17")'> 17: # PyGMI is distributed in the hope that it will be useful,</pre>
<pre id='line17' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line18")'> 18: # but WITHOUT ANY WARRANTY; without even the implied warranty of</pre>
<pre id='line18' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line19")'> 19: # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</pre>
<pre id='line19' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line20")'> 20: # GNU General Public License for more details.</pre>
<pre id='line20' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line21")'> 21: #</pre>
<pre id='line21' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line22")'> 22: # You should have received a copy of the GNU General Public License</pre>
<pre id='line22' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line23")'> 23: # along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</pre>
<pre id='line23' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line24")'> 24: #------------------------------------------------------------------------------</pre>
<pre id='line24' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line25")'> 25: """ Gravity and magnetic field calculations. This uses the algorithm</pre>
<pre id='line25' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line26")'> 26: by Blakely, as well as some other standard code.</pre>
<pre id='line26' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line27")'> 27: </pre>
<pre id='line27' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line28")'> 28: GravMag - Routine that will calculate the final versions of the field. Other,</pre>
<pre id='line28' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line29")'> 29: related code is here as well, such as the inversion routines.</pre>
<pre id='line29' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line30")'> 30: </pre>
<pre id='line30' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line31")'> 31: GeoData - The is a class which contains the geophysical information for a</pre>
<pre id='line31' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line32")'> 32: single lithology. This includes the final calculated field for that lithology</pre>
<pre id='line32' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line33")'> 33: only """</pre>
<pre id='line33' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line34")'> 34: </pre>
<pre id='line34' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line35")'> 35: # To generate grvmagc.pyd:</pre>
<pre id='line35' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line36")'> 36: # Open winpython command prompt (it has all python paths already)</pre>
<pre id='line36' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line37")'> 37: # Type the following commands:</pre>
<pre id='line37' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line38")'> 38: # cpp.bat:</pre>
<pre id='line38' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line39")'> 39: #   CALL "C:\Program Files\Microsoft SDKs\Windows\v7.1\Bin\SetEnv.cmd" /x64</pre>
<pre id='line39' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line40")'> 40: #   cd "C:\Users\pcole.CGS\Work\Programming\PyGMI2\packages\pfmod"</pre>
<pre id='line40' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line41")'> 41: # c1.bat:</pre>
<pre id='line41' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line42")'> 42: #   cython -a grvmagc.pyx</pre>
<pre id='line42' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line43")'> 43: # c2.bat:</pre>
<pre id='line43' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line44")'> 44: #   cl  grvmagc.c /I"C:\WinPython-64bit-3.3.2.1\python-3.3.2.amd64\include"</pre>
<pre id='line44' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line45")'> 45: #       /I"C:\WinPython-64bit-3.3.2.1\python-3.3.2.amd64\lib\site-packages\</pre>
<pre id='line45' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line46")'> 46: #       numpy\core\include" /link /dll</pre>
<pre id='line46' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line47")'> 47: #       /libpath:"C:\WinPython-64bit-3.3.2.1\python-3.3.2.amd64\libs"</pre>
<pre id='line47' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line48")'> 48: #       /out:grvmagc.pyd</pre>
<pre id='line48' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line49")'> 49: </pre>
<pre id='line49' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line50")'> 50: #define NPY_NO_DEPRECIATED_API NPY_1_7_API_VERSION</pre>
<pre id='line50' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line51")'> 51: import numpy as np</pre>
<pre id='line51' class='code' style='background-color: #FFFF8d'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line52")'> 52: cimport numpy as np</pre>
<pre id='line52' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line53")'> 53: import cython</pre>
<pre id='line53' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line54")'> 54: cimport cython</pre>
<pre id='line54' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line55")'> 55: from libc.math cimport sqrt</pre>
<pre id='line55' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line56")'> 56: from libc.math cimport log</pre>
<pre id='line56' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line57")'> 57: from libc.math cimport atan2</pre>
<pre id='line57' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line58")'> 58: from libc.math cimport acos</pre>
<pre id='line58' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line59")'> 59: </pre>
<pre id='line59' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line60")'> 60: DTYPEI = np.int</pre>
<pre id='line60' class='code' style='background-color: #FFFF79'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_DTYPEI, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line61")'> 61: ctypedef np.int_t DTYPEI_t</pre>
<pre id='line61' class='code' style='background-color: #FFFFff'>typedef __pyx_t_5numpy_int_t __pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line62")'> 62: DTYPEF = np.float32</pre>
<pre id='line62' class='code' style='background-color: #FFFF79'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_DTYPEF, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line63")'> 63: ctypedef np.float32_t DTYPEF_t</pre>
<pre id='line63' class='code' style='background-color: #FFFFff'>typedef __pyx_t_5numpy_float32_t __pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEF_t;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line64")'> 64: DTYPED = np.double</pre>
<pre id='line64' class='code' style='background-color: #FFFF79'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_double);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_DTYPED, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line65")'> 65: ctypedef np.double_t DTYPED_t</pre>
<pre id='line65' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line66")'> 66: </pre>
<pre id='line66' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line67")'> 67: DEF pi = 3.141592653589793</pre>
<pre id='line67' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line68")'> 68: ##DEF Gc = 6.6732e-3 # 6.67384?</pre>
<pre id='line68' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line69")'> 69: </pre>
<pre id='line69' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line70")'> 70: </pre>
<pre id='line70' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line71")'> 71: @cython.boundscheck(False)</pre>
<pre id='line71' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line72")'> 72: @cython.wraparound(False)</pre>
<pre id='line72' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line73")'> 73: @cython.nonecheck(False)</pre>
<pre id='line73' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line74")'> 74: </pre>
<pre id='line74' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line75")'> 75: </pre>
<pre id='line75' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF09' onclick='toggleDiv("line76")'> 76: def gm3d(int npro, int nstn,</pre>
<pre id='line76' class='code' style='background-color: #FFFF09'>/* Python wrapper */
static PyObject *__pyx_pw_8packages_5pfmod_14grvmagc_27_x64_1gm3d(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8packages_5pfmod_14grvmagc_27_x64_gm3d[] = " grvmag 3d ";
static PyMethodDef __pyx_mdef_8packages_5pfmod_14grvmagc_27_x64_1gm3d = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("gm3d"), (PyCFunction)__pyx_pw_8packages_5pfmod_14grvmagc_27_x64_1gm3d, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_8packages_5pfmod_14grvmagc_27_x64_gm3d)};
static PyObject *__pyx_pw_8packages_5pfmod_14grvmagc_27_x64_1gm3d(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_npro;
  int __pyx_v_nstn;
  PyArrayObject *__pyx_v_X = 0;
  PyArrayObject *__pyx_v_Y = 0;
  PyArrayObject *__pyx_v_Edge = 0;
  PyObject *__pyx_v_Corner = 0;
  PyObject *__pyx_v_Face = 0;
  PyArrayObject *__pyx_v_Gx = 0;
  PyArrayObject *__pyx_v_Gy = 0;
  PyArrayObject *__pyx_v_Gz = 0;
  PyArrayObject *__pyx_v_Hx = 0;
  PyArrayObject *__pyx_v_Hy = 0;
  PyArrayObject *__pyx_v_Hz = 0;
  PyArrayObject *__pyx_v_Pd = 0;
  PyObject *__pyx_v_Un = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gm3d (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_npro,&amp;__pyx_n_s_nstn,&amp;__pyx_n_s_X,&amp;__pyx_n_s_Y,&amp;__pyx_n_s_Edge,&amp;__pyx_n_s_Corner,&amp;__pyx_n_s_Face,&amp;__pyx_n_s_Gx,&amp;__pyx_n_s_Gy,&amp;__pyx_n_s_Gz,&amp;__pyx_n_s_Hx,&amp;__pyx_n_s_Hy,&amp;__pyx_n_s_Hz,&amp;__pyx_n_s_Pd,&amp;__pyx_n_s_Un,0};
    PyObject* values[15] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_npro)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_nstn)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gm3d", 1, 15, 15, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gm3d", 1, 15, 15, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_Y)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gm3d", 1, 15, 15, 3); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        if (likely((values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_Edge)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gm3d", 1, 15, 15, 4); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  5:
        if (likely((values[5] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_Corner)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gm3d", 1, 15, 15, 5); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  6:
        if (likely((values[6] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_Face)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gm3d", 1, 15, 15, 6); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  7:
        if (likely((values[7] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_Gx)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gm3d", 1, 15, 15, 7); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  8:
        if (likely((values[8] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_Gy)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gm3d", 1, 15, 15, 8); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  9:
        if (likely((values[9] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_Gz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gm3d", 1, 15, 15, 9); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 10:
        if (likely((values[10] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_Hx)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gm3d", 1, 15, 15, 10); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 11:
        if (likely((values[11] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_Hy)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gm3d", 1, 15, 15, 11); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 12:
        if (likely((values[12] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_Hz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gm3d", 1, 15, 15, 12); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 13:
        if (likely((values[13] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_Pd)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gm3d", 1, 15, 15, 13); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 14:
        if (likely((values[14] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_Un)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gm3d", 1, 15, 15, 14); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gm3d") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 15) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
      values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
      values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
      values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
      values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
      values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
      values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
      values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
      values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
    }
    __pyx_v_npro = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_npro == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_nstn = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_nstn == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_X = ((PyArrayObject *)values[2]);
    __pyx_v_Y = ((PyArrayObject *)values[3]);
    __pyx_v_Edge = ((PyArrayObject *)values[4]);
    __pyx_v_Corner = ((PyObject*)values[5]);
    __pyx_v_Face = ((PyObject*)values[6]);
    __pyx_v_Gx = ((PyArrayObject *)values[7]);
    __pyx_v_Gy = ((PyArrayObject *)values[8]);
    __pyx_v_Gz = ((PyArrayObject *)values[9]);
    __pyx_v_Hx = ((PyArrayObject *)values[10]);
    __pyx_v_Hy = ((PyArrayObject *)values[11]);
    __pyx_v_Hz = ((PyArrayObject *)values[12]);
    __pyx_v_Pd = ((PyArrayObject *)values[13]);
    __pyx_v_Un = ((PyObject*)values[14]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gm3d", 1, 15, 15, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("packages.pfmod.grvmagc_27_x64.gm3d", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_Y), __pyx_ptype_5numpy_ndarray, 1, "Y", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_Edge), __pyx_ptype_5numpy_ndarray, 1, "Edge", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_Corner), (&amp;PyList_Type), 1, "Corner", 1))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_Face), (&amp;PyList_Type), 1, "Face", 1))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_Gx), __pyx_ptype_5numpy_ndarray, 1, "Gx", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_Gy), __pyx_ptype_5numpy_ndarray, 1, "Gy", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_Gz), __pyx_ptype_5numpy_ndarray, 1, "Gz", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_Hx), __pyx_ptype_5numpy_ndarray, 1, "Hx", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_Hy), __pyx_ptype_5numpy_ndarray, 1, "Hy", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_Hz), __pyx_ptype_5numpy_ndarray, 1, "Hz", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_Pd), __pyx_ptype_5numpy_ndarray, 1, "Pd", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_Un), (&amp;PyList_Type), 1, "Un", 1))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_8packages_5pfmod_14grvmagc_27_x64_gm3d(__pyx_self, __pyx_v_npro, __pyx_v_nstn, __pyx_v_X, __pyx_v_Y, __pyx_v_Edge, __pyx_v_Corner, __pyx_v_Face, __pyx_v_Gx, __pyx_v_Gy, __pyx_v_Gz, __pyx_v_Hx, __pyx_v_Hy, __pyx_v_Hz, __pyx_v_Pd, __pyx_v_Un);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_8packages_5pfmod_14grvmagc_27_x64_gm3d(CYTHON_UNUSED PyObject *__pyx_self, int __pyx_v_npro, int __pyx_v_nstn, PyArrayObject *__pyx_v_X, PyArrayObject *__pyx_v_Y, PyArrayObject *__pyx_v_Edge, PyObject *__pyx_v_Corner, PyObject *__pyx_v_Face, PyArrayObject *__pyx_v_Gx, PyArrayObject *__pyx_v_Gy, PyArrayObject *__pyx_v_Gz, PyArrayObject *__pyx_v_Hx, PyArrayObject *__pyx_v_Hy, PyArrayObject *__pyx_v_Hz, PyArrayObject *__pyx_v_Pd, PyObject *__pyx_v_Un) {
  int __pyx_v_eno2;
  int __pyx_v_eno1;
  double __pyx_v_flimit;
  double __pyx_v_gmtf1;
  double __pyx_v_gmtf2;
  double __pyx_v_gmtf3;
  double __pyx_v_Omega;
  double __pyx_v_l;
  double __pyx_v_m;
  double __pyx_v_n;
  double __pyx_v_p;
  double __pyx_v_q;
  double __pyx_v_r;
  double __pyx_v_r12;
  double __pyx_v_L;
  double __pyx_v_Unf[3];
  double __pyx_v_p1[3];
  double __pyx_v_p2[3];
  double __pyx_v_p3[3];
  double __pyx_v_crs[4][3];
  double __pyx_v_V[24][3];
  int __pyx_v_g;
  int __pyx_v_pr;
  int __pyx_v_st;
  int __pyx_v_f;
  int __pyx_v_t;
  double __pyx_v_x;
  double __pyx_v_y;
  int __pyx_v_cindx;
  double __pyx_v_dp1;
  double __pyx_v_W;
  int __pyx_v_indx[6];
  double __pyx_v_I;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Edge;
  __Pyx_Buffer __pyx_pybuffer_Edge;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Gx;
  __Pyx_Buffer __pyx_pybuffer_Gx;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Gy;
  __Pyx_Buffer __pyx_pybuffer_Gy;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Gz;
  __Pyx_Buffer __pyx_pybuffer_Gz;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Hx;
  __Pyx_Buffer __pyx_pybuffer_Hx;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Hy;
  __Pyx_Buffer __pyx_pybuffer_Hy;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Hz;
  __Pyx_Buffer __pyx_pybuffer_Hz;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pd;
  __Pyx_Buffer __pyx_pybuffer_Pd;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_X;
  __Pyx_Buffer __pyx_pybuffer_X;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Y;
  __Pyx_Buffer __pyx_pybuffer_Y;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gm3d", 0);
  __pyx_pybuffer_X.pybuffer.buf = NULL;
  __pyx_pybuffer_X.refcount = 0;
  __pyx_pybuffernd_X.data = NULL;
  __pyx_pybuffernd_X.rcbuffer = &amp;__pyx_pybuffer_X;
  __pyx_pybuffer_Y.pybuffer.buf = NULL;
  __pyx_pybuffer_Y.refcount = 0;
  __pyx_pybuffernd_Y.data = NULL;
  __pyx_pybuffernd_Y.rcbuffer = &amp;__pyx_pybuffer_Y;
  __pyx_pybuffer_Edge.pybuffer.buf = NULL;
  __pyx_pybuffer_Edge.refcount = 0;
  __pyx_pybuffernd_Edge.data = NULL;
  __pyx_pybuffernd_Edge.rcbuffer = &amp;__pyx_pybuffer_Edge;
  __pyx_pybuffer_Gx.pybuffer.buf = NULL;
  __pyx_pybuffer_Gx.refcount = 0;
  __pyx_pybuffernd_Gx.data = NULL;
  __pyx_pybuffernd_Gx.rcbuffer = &amp;__pyx_pybuffer_Gx;
  __pyx_pybuffer_Gy.pybuffer.buf = NULL;
  __pyx_pybuffer_Gy.refcount = 0;
  __pyx_pybuffernd_Gy.data = NULL;
  __pyx_pybuffernd_Gy.rcbuffer = &amp;__pyx_pybuffer_Gy;
  __pyx_pybuffer_Gz.pybuffer.buf = NULL;
  __pyx_pybuffer_Gz.refcount = 0;
  __pyx_pybuffernd_Gz.data = NULL;
  __pyx_pybuffernd_Gz.rcbuffer = &amp;__pyx_pybuffer_Gz;
  __pyx_pybuffer_Hx.pybuffer.buf = NULL;
  __pyx_pybuffer_Hx.refcount = 0;
  __pyx_pybuffernd_Hx.data = NULL;
  __pyx_pybuffernd_Hx.rcbuffer = &amp;__pyx_pybuffer_Hx;
  __pyx_pybuffer_Hy.pybuffer.buf = NULL;
  __pyx_pybuffer_Hy.refcount = 0;
  __pyx_pybuffernd_Hy.data = NULL;
  __pyx_pybuffernd_Hy.rcbuffer = &amp;__pyx_pybuffer_Hy;
  __pyx_pybuffer_Hz.pybuffer.buf = NULL;
  __pyx_pybuffer_Hz.refcount = 0;
  __pyx_pybuffernd_Hz.data = NULL;
  __pyx_pybuffernd_Hz.rcbuffer = &amp;__pyx_pybuffer_Hz;
  __pyx_pybuffer_Pd.pybuffer.buf = NULL;
  __pyx_pybuffer_Pd.refcount = 0;
  __pyx_pybuffernd_Pd.data = NULL;
  __pyx_pybuffernd_Pd.rcbuffer = &amp;__pyx_pybuffer_Pd;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_X.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_X, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_X.diminfo[0].strides = __pyx_pybuffernd_X.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_X.diminfo[0].shape = __pyx_pybuffernd_X.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_X.diminfo[1].strides = __pyx_pybuffernd_X.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_X.diminfo[1].shape = __pyx_pybuffernd_X.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Y.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Y, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Y.diminfo[0].strides = __pyx_pybuffernd_Y.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Y.diminfo[0].shape = __pyx_pybuffernd_Y.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Y.diminfo[1].strides = __pyx_pybuffernd_Y.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Y.diminfo[1].shape = __pyx_pybuffernd_Y.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Edge.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Edge, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Edge.diminfo[0].strides = __pyx_pybuffernd_Edge.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Edge.diminfo[0].shape = __pyx_pybuffernd_Edge.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Edge.diminfo[1].strides = __pyx_pybuffernd_Edge.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Edge.diminfo[1].shape = __pyx_pybuffernd_Edge.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Gx.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Gx, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Gx.diminfo[0].strides = __pyx_pybuffernd_Gx.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Gx.diminfo[0].shape = __pyx_pybuffernd_Gx.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Gx.diminfo[1].strides = __pyx_pybuffernd_Gx.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Gx.diminfo[1].shape = __pyx_pybuffernd_Gx.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Gy.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Gy, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Gy.diminfo[0].strides = __pyx_pybuffernd_Gy.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Gy.diminfo[0].shape = __pyx_pybuffernd_Gy.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Gy.diminfo[1].strides = __pyx_pybuffernd_Gy.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Gy.diminfo[1].shape = __pyx_pybuffernd_Gy.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Gz.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Gz, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Gz.diminfo[0].strides = __pyx_pybuffernd_Gz.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Gz.diminfo[0].shape = __pyx_pybuffernd_Gz.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Gz.diminfo[1].strides = __pyx_pybuffernd_Gz.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Gz.diminfo[1].shape = __pyx_pybuffernd_Gz.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Hx.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Hx, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Hx.diminfo[0].strides = __pyx_pybuffernd_Hx.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Hx.diminfo[0].shape = __pyx_pybuffernd_Hx.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Hx.diminfo[1].strides = __pyx_pybuffernd_Hx.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Hx.diminfo[1].shape = __pyx_pybuffernd_Hx.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Hy.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Hy, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Hy.diminfo[0].strides = __pyx_pybuffernd_Hy.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Hy.diminfo[0].shape = __pyx_pybuffernd_Hy.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Hy.diminfo[1].strides = __pyx_pybuffernd_Hy.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Hy.diminfo[1].shape = __pyx_pybuffernd_Hy.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Hz.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Hz, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Hz.diminfo[0].strides = __pyx_pybuffernd_Hz.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Hz.diminfo[0].shape = __pyx_pybuffernd_Hz.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Hz.diminfo[1].strides = __pyx_pybuffernd_Hz.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Hz.diminfo[1].shape = __pyx_pybuffernd_Hz.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pd.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Pd, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Pd.diminfo[0].strides = __pyx_pybuffernd_Pd.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pd.diminfo[0].shape = __pyx_pybuffernd_Pd.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Edge.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Gx.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Gy.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Gz.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Hx.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Hy.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Hz.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pd.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_X.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Y.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("packages.pfmod.grvmagc_27_x64.gm3d", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Edge.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Gx.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Gy.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Gz.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Hx.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Hy.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Hz.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pd.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_X.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Y.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__10 = <span class='py_c_api'>PyTuple_Pack</span>(49, __pyx_n_s_npro, __pyx_n_s_nstn, __pyx_n_s_X, __pyx_n_s_Y, __pyx_n_s_Edge, __pyx_n_s_Corner, __pyx_n_s_Face, __pyx_n_s_Gx, __pyx_n_s_Gy, __pyx_n_s_Gz, __pyx_n_s_Hx, __pyx_n_s_Hy, __pyx_n_s_Hz, __pyx_n_s_Pd, __pyx_n_s_Un, __pyx_n_s_eno2, __pyx_n_s_eno1, __pyx_n_s_flimit, __pyx_n_s_gmtf1, __pyx_n_s_gmtf2, __pyx_n_s_gmtf3, __pyx_n_s_Omega, __pyx_n_s_l, __pyx_n_s_m, __pyx_n_s_n, __pyx_n_s_p, __pyx_n_s_q, __pyx_n_s_r, __pyx_n_s_r12, __pyx_n_s_L, __pyx_n_s_fsign, __pyx_n_s_Unf, __pyx_n_s_p1, __pyx_n_s_p2, __pyx_n_s_p3, __pyx_n_s_crs, __pyx_n_s_V, __pyx_n_s_g, __pyx_n_s_pr, __pyx_n_s_st, __pyx_n_s_f, __pyx_n_s_t, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_cindx, __pyx_n_s_dp1, __pyx_n_s_W, __pyx_n_s_indx, __pyx_n_s_I);<span class='error_goto'> if (unlikely(!__pyx_tuple__10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__10);
/* … */
  __pyx_t_2 = PyCFunction_NewEx(&amp;__pyx_mdef_8packages_5pfmod_14grvmagc_27_x64_1gm3d, NULL, __pyx_n_s_packages_pfmod_grvmagc_27_x64);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_gm3d, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_codeobj__11 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(15, 0, 49, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__10, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_C_Work_Programming_PyGMI2_packag, __pyx_n_s_gm3d, 76, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line77")'> 77:          np.ndarray[DTYPED_t, ndim=2] X,</pre>
<pre id='line77' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line78")'> 78:          np.ndarray[DTYPED_t, ndim=2] Y,</pre>
<pre id='line78' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line79")'> 79:          np.ndarray[DTYPED_t, ndim=2] Edge,</pre>
<pre id='line79' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line80")'> 80:          list Corner,</pre>
<pre id='line80' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line81")'> 81:          list Face,</pre>
<pre id='line81' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line82")'> 82:          np.ndarray[DTYPED_t, ndim=2] Gx,</pre>
<pre id='line82' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line83")'> 83:          np.ndarray[DTYPED_t, ndim=2] Gy,</pre>
<pre id='line83' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line84")'> 84:          np.ndarray[DTYPED_t, ndim=2] Gz,</pre>
<pre id='line84' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line85")'> 85:          np.ndarray[DTYPED_t, ndim=2] Hx,</pre>
<pre id='line85' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line86")'> 86:          np.ndarray[DTYPED_t, ndim=2] Hy,</pre>
<pre id='line86' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line87")'> 87:          np.ndarray[DTYPED_t, ndim=2] Hz,</pre>
<pre id='line87' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line88")'> 88:          np.ndarray[DTYPED_t, ndim=1] Pd,</pre>
<pre id='line88' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line89")'> 89:          list Un):</pre>
<pre id='line89' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line90")'> 90:     """ grvmag 3d """</pre>
<pre id='line90' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line91")'> 91: </pre>
<pre id='line91' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line92")'> 92:     cdef int eno2</pre>
<pre id='line92' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line93")'> 93:     cdef int eno1</pre>
<pre id='line93' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line94")'> 94:     cdef double flimit</pre>
<pre id='line94' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line95")'> 95:     cdef double gmtf1</pre>
<pre id='line95' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line96")'> 96:     cdef double gmtf2</pre>
<pre id='line96' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line97")'> 97:     cdef double gmtf3</pre>
<pre id='line97' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line98")'> 98:     cdef double Omega</pre>
<pre id='line98' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line99")'> 99:     cdef double l</pre>
<pre id='line99' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line100")'> 100:     cdef double m</pre>
<pre id='line100' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line101")'> 101:     cdef double n</pre>
<pre id='line101' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line102")'> 102:     cdef double p</pre>
<pre id='line102' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line103")'> 103:     cdef double q</pre>
<pre id='line103' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line104")'> 104:     cdef double r</pre>
<pre id='line104' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line105")'> 105:     cdef double r12</pre>
<pre id='line105' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line106")'> 106:     cdef double L</pre>
<pre id='line106' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line107")'> 107:     cdef double fsign</pre>
<pre id='line107' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line108")'> 108:     cdef double Unf[3]</pre>
<pre id='line108' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line109")'> 109:     cdef double p1[3]</pre>
<pre id='line109' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line110")'> 110:     cdef double p2[3]</pre>
<pre id='line110' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line111")'> 111:     cdef double p3[3]</pre>
<pre id='line111' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line112")'> 112:     cdef double crs[4][3]</pre>
<pre id='line112' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line113")'> 113:     cdef double V[24][3]</pre>
<pre id='line113' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line114")'> 114: </pre>
<pre id='line114' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line115")'> 115:     cdef int g</pre>
<pre id='line115' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line116")'> 116:     cdef int pr</pre>
<pre id='line116' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line117")'> 117:     cdef int st</pre>
<pre id='line117' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line118")'> 118:     cdef int f</pre>
<pre id='line118' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line119")'> 119:     cdef int t</pre>
<pre id='line119' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line120")'> 120:     cdef double x</pre>
<pre id='line120' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line121")'> 121:     cdef double y</pre>
<pre id='line121' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line122")'> 122:     cdef int cindx</pre>
<pre id='line122' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line123")'> 123:     cdef double dp1</pre>
<pre id='line123' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line124")'> 124:     cdef double W</pre>
<pre id='line124' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line125")'> 125:     cdef int indx[6]</pre>
<pre id='line125' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line126")'> 126: </pre>
<pre id='line126' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF48' onclick='toggleDiv("line127")'> 127:     flimit = 64*np.spacing(1)</pre>
<pre id='line127' class='code' style='background-color: #FFFF48'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_spacing);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_tuple_, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_int_64, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_flimit = __pyx_t_3;
/* … */
  __pyx_tuple_ = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_tuple_)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple_);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line128")'> 128:     Omega = 0.0</pre>
<pre id='line128' class='code' style='background-color: #FFFFff'>  __pyx_v_Omega = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line129")'> 129:     dp1 = 1.0</pre>
<pre id='line129' class='code' style='background-color: #FFFFff'>  __pyx_v_dp1 = 1.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line130")'> 130:     I = 1.0</pre>
<pre id='line130' class='code' style='background-color: #FFFFff'>  __pyx_v_I = 1.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line131")'> 131: </pre>
<pre id='line131' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line132")'> 132:     indx[0] = 0</pre>
<pre id='line132' class='code' style='background-color: #FFFFff'>  (__pyx_v_indx[0]) = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line133")'> 133:     indx[1] = 1</pre>
<pre id='line133' class='code' style='background-color: #FFFFff'>  (__pyx_v_indx[1]) = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line134")'> 134:     indx[2] = 2</pre>
<pre id='line134' class='code' style='background-color: #FFFFff'>  (__pyx_v_indx[2]) = 2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line135")'> 135:     indx[3] = 3</pre>
<pre id='line135' class='code' style='background-color: #FFFFff'>  (__pyx_v_indx[3]) = 3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line136")'> 136:     indx[4] = 0</pre>
<pre id='line136' class='code' style='background-color: #FFFFff'>  (__pyx_v_indx[4]) = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line137")'> 137:     indx[5] = 1</pre>
<pre id='line137' class='code' style='background-color: #FFFFff'>  (__pyx_v_indx[5]) = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line138")'> 138: </pre>
<pre id='line138' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line139")'> 139:     for f in range(24):</pre>
<pre id='line139' class='code' style='background-color: #FFFFff'>  for (__pyx_t_4 = 0; __pyx_t_4 &lt; 24; __pyx_t_4+=1) {
    __pyx_v_f = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line140")'> 140:         for g in range(3):</pre>
<pre id='line140' class='code' style='background-color: #FFFFff'>    for (__pyx_t_5 = 0; __pyx_t_5 &lt; 3; __pyx_t_5+=1) {
      __pyx_v_g = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line141")'> 141:             V[f][g] = Edge[f, g]</pre>
<pre id='line141' class='code' style='background-color: #FFFFff'>      __pyx_t_6 = __pyx_v_f;
      __pyx_t_7 = __pyx_v_g;
      ((__pyx_v_V[__pyx_v_f])[__pyx_v_g]) = (*__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Edge.rcbuffer-&gt;pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_Edge.diminfo[0].strides, __pyx_t_7, __pyx_pybuffernd_Edge.diminfo[1].strides));
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line142")'> 142: </pre>
<pre id='line142' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line143")'> 143:     for pr in range(npro):</pre>
<pre id='line143' class='code' style='background-color: #FFFFff'>  __pyx_t_4 = __pyx_v_npro;
  for (__pyx_t_5 = 0; __pyx_t_5 &lt; __pyx_t_4; __pyx_t_5+=1) {
    __pyx_v_pr = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line144")'> 144:         for st in range(nstn):</pre>
<pre id='line144' class='code' style='background-color: #FFFFff'>    __pyx_t_8 = __pyx_v_nstn;
    for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
      __pyx_v_st = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line145")'> 145:             x = X[pr, st]</pre>
<pre id='line145' class='code' style='background-color: #FFFFff'>      __pyx_t_10 = __pyx_v_pr;
      __pyx_t_11 = __pyx_v_st;
      __pyx_v_x = (*__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_X.rcbuffer-&gt;pybuffer.buf, __pyx_t_10, __pyx_pybuffernd_X.diminfo[0].strides, __pyx_t_11, __pyx_pybuffernd_X.diminfo[1].strides));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line146")'> 146:             y = Y[pr, st]</pre>
<pre id='line146' class='code' style='background-color: #FFFFff'>      __pyx_t_12 = __pyx_v_pr;
      __pyx_t_13 = __pyx_v_st;
      __pyx_v_y = (*__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Y.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_Y.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_Y.diminfo[1].strides));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line147")'> 147:             for f in range(6):</pre>
<pre id='line147' class='code' style='background-color: #FFFFff'>      for (__pyx_t_14 = 0; __pyx_t_14 &lt; 6; __pyx_t_14+=1) {
        __pyx_v_f = __pyx_t_14;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line148")'> 148:                 for g in range(4):</pre>
<pre id='line148' class='code' style='background-color: #FFFFff'>        for (__pyx_t_15 = 0; __pyx_t_15 &lt; 4; __pyx_t_15+=1) {
          __pyx_v_g = __pyx_t_15;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line149")'> 149:                     cindx = Face[f][g]</pre>
<pre id='line149' class='code' style='background-color: #FFFF79'>          if (unlikely(__pyx_v_Face == Py_None)) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_Face, __pyx_v_f), __pyx_v_g, int, 1, __Pyx_PyInt_From_int, 0, 0, 0);<span class='error_goto'> if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_16 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_v_cindx = __pyx_t_16;
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line150")'> 150:                     crs[g][0] = Corner[cindx][0] - x</pre>
<pre id='line150' class='code' style='background-color: #FFFF46'>          if (unlikely(__pyx_v_Corner == Py_None)) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_Corner, __pyx_v_cindx), 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_x);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          __pyx_t_17 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_2, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_17);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
          ((__pyx_v_crs[__pyx_v_g])[0]) = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line151")'> 151:                     crs[g][1] = Corner[cindx][1] - y</pre>
<pre id='line151' class='code' style='background-color: #FFFF46'>          if (unlikely(__pyx_v_Corner == Py_None)) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_17 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_Corner, __pyx_v_cindx), 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(__pyx_t_17 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
          __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_y);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          __pyx_t_2 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_17, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          ((__pyx_v_crs[__pyx_v_g])[1]) = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line152")'> 152:                     crs[g][2] = Corner[cindx][2]</pre>
<pre id='line152' class='code' style='background-color: #FFFF6a'>          if (unlikely(__pyx_v_Corner == Py_None)) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_Corner, __pyx_v_cindx), 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          ((__pyx_v_crs[__pyx_v_g])[2]) = __pyx_t_3;
        }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line153")'> 153: </pre>
<pre id='line153' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line154")'> 154:                 p = 0</pre>
<pre id='line154' class='code' style='background-color: #FFFFff'>        __pyx_v_p = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line155")'> 155:                 q = 0</pre>
<pre id='line155' class='code' style='background-color: #FFFFff'>        __pyx_v_q = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line156")'> 156:                 r = 0</pre>
<pre id='line156' class='code' style='background-color: #FFFFff'>        __pyx_v_r = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line157")'> 157:                 eno1 = 4*f</pre>
<pre id='line157' class='code' style='background-color: #FFFFff'>        __pyx_v_eno1 = (4 * __pyx_v_f);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line158")'> 158:                 W = -2*pi</pre>
<pre id='line158' class='code' style='background-color: #FFFFff'>        __pyx_v_W = (-2.0 * 3.141592653589793);
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line159")'> 159:                 Unf[0] = Un[f][0]</pre>
<pre id='line159' class='code' style='background-color: #FFFF6a'>        if (unlikely(__pyx_v_Un == Py_None)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_Un, __pyx_v_f), 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        (__pyx_v_Unf[0]) = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line160")'> 160:                 Unf[1] = Un[f][1]</pre>
<pre id='line160' class='code' style='background-color: #FFFF6a'>        if (unlikely(__pyx_v_Un == Py_None)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_Un, __pyx_v_f), 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        (__pyx_v_Unf[1]) = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line161")'> 161:                 Unf[2] = Un[f][2]</pre>
<pre id='line161' class='code' style='background-color: #FFFF6a'>        if (unlikely(__pyx_v_Un == Py_None)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_Un, __pyx_v_f), 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        (__pyx_v_Unf[2]) = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line162")'> 162: </pre>
<pre id='line162' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line163")'> 163:                 for t in range(4):</pre>
<pre id='line163' class='code' style='background-color: #FFFFff'>        for (__pyx_t_15 = 0; __pyx_t_15 &lt; 4; __pyx_t_15+=1) {
          __pyx_v_t = __pyx_t_15;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line164")'> 164:                     p1[0] = crs[indx[t]][0]</pre>
<pre id='line164' class='code' style='background-color: #FFFFff'>          (__pyx_v_p1[0]) = ((__pyx_v_crs[(__pyx_v_indx[__pyx_v_t])])[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line165")'> 165:                     p1[1] = crs[indx[t]][1]</pre>
<pre id='line165' class='code' style='background-color: #FFFFff'>          (__pyx_v_p1[1]) = ((__pyx_v_crs[(__pyx_v_indx[__pyx_v_t])])[1]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line166")'> 166:                     p1[2] = crs[indx[t]][2]</pre>
<pre id='line166' class='code' style='background-color: #FFFFff'>          (__pyx_v_p1[2]) = ((__pyx_v_crs[(__pyx_v_indx[__pyx_v_t])])[2]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line167")'> 167:                     p2[0] = crs[indx[t+1]][0]</pre>
<pre id='line167' class='code' style='background-color: #FFFFff'>          (__pyx_v_p2[0]) = ((__pyx_v_crs[(__pyx_v_indx[(__pyx_v_t + 1)])])[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line168")'> 168:                     p2[1] = crs[indx[t+1]][1]</pre>
<pre id='line168' class='code' style='background-color: #FFFFff'>          (__pyx_v_p2[1]) = ((__pyx_v_crs[(__pyx_v_indx[(__pyx_v_t + 1)])])[1]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line169")'> 169:                     p2[2] = crs[indx[t+1]][2]</pre>
<pre id='line169' class='code' style='background-color: #FFFFff'>          (__pyx_v_p2[2]) = ((__pyx_v_crs[(__pyx_v_indx[(__pyx_v_t + 1)])])[2]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line170")'> 170:                     p3[0] = crs[indx[t+2]][0]</pre>
<pre id='line170' class='code' style='background-color: #FFFFff'>          (__pyx_v_p3[0]) = ((__pyx_v_crs[(__pyx_v_indx[(__pyx_v_t + 2)])])[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line171")'> 171:                     p3[1] = crs[indx[t+2]][1]</pre>
<pre id='line171' class='code' style='background-color: #FFFFff'>          (__pyx_v_p3[1]) = ((__pyx_v_crs[(__pyx_v_indx[(__pyx_v_t + 2)])])[1]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line172")'> 172:                     p3[2] = crs[indx[t+2]][2]</pre>
<pre id='line172' class='code' style='background-color: #FFFFff'>          (__pyx_v_p3[2]) = ((__pyx_v_crs[(__pyx_v_indx[(__pyx_v_t + 2)])])[2]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line173")'> 173:                     W += angle(p1, p2, p3, Unf, flimit)</pre>
<pre id='line173' class='code' style='background-color: #FFFFff'>          __pyx_v_W = (__pyx_v_W + __pyx_f_8packages_5pfmod_14grvmagc_27_x64_angle(__pyx_v_p1, __pyx_v_p2, __pyx_v_p3, __pyx_v_Unf, __pyx_v_flimit));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line174")'> 174: </pre>
<pre id='line174' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line175")'> 175:                     eno2 = eno1+t   # Edge no</pre>
<pre id='line175' class='code' style='background-color: #FFFFff'>          __pyx_v_eno2 = (__pyx_v_eno1 + __pyx_v_t);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line176")'> 176:                     L = Edge[eno2, 3]</pre>
<pre id='line176' class='code' style='background-color: #FFFFff'>          __pyx_t_16 = __pyx_v_eno2;
          __pyx_t_18 = 3;
          __pyx_v_L = (*__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Edge.rcbuffer-&gt;pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_Edge.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_Edge.diminfo[1].strides));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line177")'> 177: </pre>
<pre id='line177' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line178")'> 178:                     r12 = norm(p1)+norm(p2)</pre>
<pre id='line178' class='code' style='background-color: #FFFFff'>          __pyx_v_r12 = (__pyx_f_8packages_5pfmod_14grvmagc_27_x64_norm(__pyx_v_p1) + __pyx_f_8packages_5pfmod_14grvmagc_27_x64_norm(__pyx_v_p2));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line179")'> 179: </pre>
<pre id='line179' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line180")'> 180:                     I = (1/L)*log((r12+L)/(r12-L))</pre>
<pre id='line180' class='code' style='background-color: #FFFF7f'>          if (unlikely(__pyx_v_L == 0)) {
            #ifdef WITH_THREAD
            PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
            #endif
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
            #ifdef WITH_THREAD
            PyGILState_Release(__pyx_gilstate_save);
            #endif
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_3 = (__pyx_v_r12 + __pyx_v_L);
          __pyx_t_19 = (__pyx_v_r12 - __pyx_v_L);
          if (unlikely(__pyx_t_19 == 0)) {
            #ifdef WITH_THREAD
            PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
            #endif
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
            #ifdef WITH_THREAD
            PyGILState_Release(__pyx_gilstate_save);
            #endif
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_v_I = ((1.0 / __pyx_v_L) * log((__pyx_t_3 / __pyx_t_19)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line181")'> 181: </pre>
<pre id='line181' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line182")'> 182:                     p += I*V[eno2][0]</pre>
<pre id='line182' class='code' style='background-color: #FFFFff'>          __pyx_v_p = (__pyx_v_p + (__pyx_v_I * ((__pyx_v_V[__pyx_v_eno2])[0])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line183")'> 183:                     q += I*V[eno2][1]</pre>
<pre id='line183' class='code' style='background-color: #FFFFff'>          __pyx_v_q = (__pyx_v_q + (__pyx_v_I * ((__pyx_v_V[__pyx_v_eno2])[1])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line184")'> 184:                     r += I*V[eno2][2]</pre>
<pre id='line184' class='code' style='background-color: #FFFFff'>          __pyx_v_r = (__pyx_v_r + (__pyx_v_I * ((__pyx_v_V[__pyx_v_eno2])[2])));
        }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line185")'> 185: </pre>
<pre id='line185' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line186")'> 186:         #        From Omega, l, m, n PQR get components of field due to face f</pre>
<pre id='line186' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line187")'> 187: </pre>
<pre id='line187' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line188")'> 188:                 dp1 = dot(Unf, crs[0])</pre>
<pre id='line188' class='code' style='background-color: #FFFFff'>        __pyx_v_dp1 = __pyx_f_8packages_5pfmod_14grvmagc_27_x64_dot(__pyx_v_Unf, (__pyx_v_crs[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line189")'> 189:                 if dp1 &lt; 0.:</pre>
<pre id='line189' class='code' style='background-color: #FFFFff'>        __pyx_t_20 = ((__pyx_v_dp1 &lt; 0.) != 0);
        if (__pyx_t_20) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line190")'> 190:                     Omega = W</pre>
<pre id='line190' class='code' style='background-color: #FFFFff'>          __pyx_v_Omega = __pyx_v_W;
          goto __pyx_L17;
        }
        /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line191")'> 191:                 else:</pre>
<pre id='line191' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line192")'> 192:                     Omega = -W</pre>
<pre id='line192' class='code' style='background-color: #FFFFff'>          __pyx_v_Omega = (-__pyx_v_W);
        }
        __pyx_L17:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line193")'> 193: </pre>
<pre id='line193' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line194")'> 194:                 l = Unf[0]</pre>
<pre id='line194' class='code' style='background-color: #FFFFff'>        __pyx_v_l = (__pyx_v_Unf[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line195")'> 195:                 m = Unf[1]</pre>
<pre id='line195' class='code' style='background-color: #FFFFff'>        __pyx_v_m = (__pyx_v_Unf[1]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line196")'> 196:                 n = Unf[2]</pre>
<pre id='line196' class='code' style='background-color: #FFFFff'>        __pyx_v_n = (__pyx_v_Unf[2]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line197")'> 197: </pre>
<pre id='line197' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line198")'> 198:                 gmtf1 = l*Omega+n*q-m*r</pre>
<pre id='line198' class='code' style='background-color: #FFFFff'>        __pyx_v_gmtf1 = (((__pyx_v_l * __pyx_v_Omega) + (__pyx_v_n * __pyx_v_q)) - (__pyx_v_m * __pyx_v_r));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line199")'> 199:                 gmtf2 = m*Omega+l*r-n*p</pre>
<pre id='line199' class='code' style='background-color: #FFFFff'>        __pyx_v_gmtf2 = (((__pyx_v_m * __pyx_v_Omega) + (__pyx_v_l * __pyx_v_r)) - (__pyx_v_n * __pyx_v_p));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line200")'> 200:                 gmtf3 = n*Omega+m*p-l*q</pre>
<pre id='line200' class='code' style='background-color: #FFFFff'>        __pyx_v_gmtf3 = (((__pyx_v_n * __pyx_v_Omega) + (__pyx_v_m * __pyx_v_p)) - (__pyx_v_l * __pyx_v_q));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line201")'> 201: </pre>
<pre id='line201' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line202")'> 202:                 Hx[pr, st] = Hx[pr, st]+Pd[f]*gmtf1</pre>
<pre id='line202' class='code' style='background-color: #FFFFff'>        __pyx_t_15 = __pyx_v_pr;
        __pyx_t_21 = __pyx_v_st;
        __pyx_t_22 = __pyx_v_f;
        __pyx_t_23 = __pyx_v_pr;
        __pyx_t_24 = __pyx_v_st;
        *__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Hx.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_Hx.diminfo[0].strides, __pyx_t_24, __pyx_pybuffernd_Hx.diminfo[1].strides) = ((*__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Hx.rcbuffer-&gt;pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_Hx.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_Hx.diminfo[1].strides)) + ((*__Pyx_BufPtrStrided1d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Pd.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_Pd.diminfo[0].strides)) * __pyx_v_gmtf1));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line203")'> 203:                 Hy[pr, st] = Hy[pr, st]+Pd[f]*gmtf2</pre>
<pre id='line203' class='code' style='background-color: #FFFFff'>        __pyx_t_25 = __pyx_v_pr;
        __pyx_t_26 = __pyx_v_st;
        __pyx_t_27 = __pyx_v_f;
        __pyx_t_28 = __pyx_v_pr;
        __pyx_t_29 = __pyx_v_st;
        *__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Hy.rcbuffer-&gt;pybuffer.buf, __pyx_t_28, __pyx_pybuffernd_Hy.diminfo[0].strides, __pyx_t_29, __pyx_pybuffernd_Hy.diminfo[1].strides) = ((*__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Hy.rcbuffer-&gt;pybuffer.buf, __pyx_t_25, __pyx_pybuffernd_Hy.diminfo[0].strides, __pyx_t_26, __pyx_pybuffernd_Hy.diminfo[1].strides)) + ((*__Pyx_BufPtrStrided1d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Pd.rcbuffer-&gt;pybuffer.buf, __pyx_t_27, __pyx_pybuffernd_Pd.diminfo[0].strides)) * __pyx_v_gmtf2));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line204")'> 204:                 Hz[pr, st] = Hz[pr, st]+Pd[f]*gmtf3</pre>
<pre id='line204' class='code' style='background-color: #FFFFff'>        __pyx_t_30 = __pyx_v_pr;
        __pyx_t_31 = __pyx_v_st;
        __pyx_t_32 = __pyx_v_f;
        __pyx_t_33 = __pyx_v_pr;
        __pyx_t_34 = __pyx_v_st;
        *__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Hz.rcbuffer-&gt;pybuffer.buf, __pyx_t_33, __pyx_pybuffernd_Hz.diminfo[0].strides, __pyx_t_34, __pyx_pybuffernd_Hz.diminfo[1].strides) = ((*__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Hz.rcbuffer-&gt;pybuffer.buf, __pyx_t_30, __pyx_pybuffernd_Hz.diminfo[0].strides, __pyx_t_31, __pyx_pybuffernd_Hz.diminfo[1].strides)) + ((*__Pyx_BufPtrStrided1d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Pd.rcbuffer-&gt;pybuffer.buf, __pyx_t_32, __pyx_pybuffernd_Pd.diminfo[0].strides)) * __pyx_v_gmtf3));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line205")'> 205: </pre>
<pre id='line205' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line206")'> 206:                 Gx[pr, st] = Gx[pr, st]-dp1*gmtf1</pre>
<pre id='line206' class='code' style='background-color: #FFFFff'>        __pyx_t_35 = __pyx_v_pr;
        __pyx_t_36 = __pyx_v_st;
        __pyx_t_37 = __pyx_v_pr;
        __pyx_t_38 = __pyx_v_st;
        *__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Gx.rcbuffer-&gt;pybuffer.buf, __pyx_t_37, __pyx_pybuffernd_Gx.diminfo[0].strides, __pyx_t_38, __pyx_pybuffernd_Gx.diminfo[1].strides) = ((*__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Gx.rcbuffer-&gt;pybuffer.buf, __pyx_t_35, __pyx_pybuffernd_Gx.diminfo[0].strides, __pyx_t_36, __pyx_pybuffernd_Gx.diminfo[1].strides)) - (__pyx_v_dp1 * __pyx_v_gmtf1));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line207")'> 207:                 Gy[pr, st] = Gy[pr, st]-dp1*gmtf2</pre>
<pre id='line207' class='code' style='background-color: #FFFFff'>        __pyx_t_39 = __pyx_v_pr;
        __pyx_t_40 = __pyx_v_st;
        __pyx_t_41 = __pyx_v_pr;
        __pyx_t_42 = __pyx_v_st;
        *__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Gy.rcbuffer-&gt;pybuffer.buf, __pyx_t_41, __pyx_pybuffernd_Gy.diminfo[0].strides, __pyx_t_42, __pyx_pybuffernd_Gy.diminfo[1].strides) = ((*__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Gy.rcbuffer-&gt;pybuffer.buf, __pyx_t_39, __pyx_pybuffernd_Gy.diminfo[0].strides, __pyx_t_40, __pyx_pybuffernd_Gy.diminfo[1].strides)) - (__pyx_v_dp1 * __pyx_v_gmtf2));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line208")'> 208:                 Gz[pr, st] = Gz[pr, st]-dp1*gmtf3</pre>
<pre id='line208' class='code' style='background-color: #FFFFff'>        __pyx_t_43 = __pyx_v_pr;
        __pyx_t_44 = __pyx_v_st;
        __pyx_t_45 = __pyx_v_pr;
        __pyx_t_46 = __pyx_v_st;
        *__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Gz.rcbuffer-&gt;pybuffer.buf, __pyx_t_45, __pyx_pybuffernd_Gz.diminfo[0].strides, __pyx_t_46, __pyx_pybuffernd_Gz.diminfo[1].strides) = ((*__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_Gz.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_Gz.diminfo[0].strides, __pyx_t_44, __pyx_pybuffernd_Gz.diminfo[1].strides)) - (__pyx_v_dp1 * __pyx_v_gmtf3));
      }
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line209")'> 209: </pre>
<pre id='line209' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line210")'> 210: cdef inline double dot(double a[3], double b[3]):</pre>
<pre id='line210' class='code' style='background-color: #FFFFff'>static CYTHON_INLINE double __pyx_f_8packages_5pfmod_14grvmagc_27_x64_dot(double *__pyx_v_a, double *__pyx_v_b) {
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dot", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line211")'> 211:     return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]</pre>
<pre id='line211' class='code' style='background-color: #FFFFff'>  __pyx_r = ((((__pyx_v_a[0]) * (__pyx_v_b[0])) + ((__pyx_v_a[1]) * (__pyx_v_b[1]))) + ((__pyx_v_a[2]) * (__pyx_v_b[2])));
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line212")'> 212: </pre>
<pre id='line212' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line213")'> 213: cdef inline double norm(double a[3]):</pre>
<pre id='line213' class='code' style='background-color: #FFFFff'>static CYTHON_INLINE double __pyx_f_8packages_5pfmod_14grvmagc_27_x64_norm(double *__pyx_v_a) {
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("norm", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line214")'> 214:     return sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])</pre>
<pre id='line214' class='code' style='background-color: #FFFFff'>  __pyx_r = sqrt(((((__pyx_v_a[0]) * (__pyx_v_a[0])) + ((__pyx_v_a[1]) * (__pyx_v_a[1]))) + ((__pyx_v_a[2]) * (__pyx_v_a[2]))));
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line215")'> 215: </pre>
<pre id='line215' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line216")'> 216: cdef inline double angle(double p1[3], double p2[3], double p3[3],</pre>
<pre id='line216' class='code' style='background-color: #FFFFb6'>static CYTHON_INLINE double __pyx_f_8packages_5pfmod_14grvmagc_27_x64_angle(double *__pyx_v_p1, double *__pyx_v_p2, double *__pyx_v_p3, double *__pyx_v_Un, double __pyx_v_flimit) {
  double __pyx_v_anout;
  double __pyx_v_pn1;
  double __pyx_v_pn2;
  double __pyx_v_ang;
  double __pyx_v_perp;
  double __pyx_v_r;
  double __pyx_v_n10;
  double __pyx_v_n11;
  double __pyx_v_n12;
  double __pyx_v_n20;
  double __pyx_v_n21;
  double __pyx_v_n22;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("angle", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("packages.pfmod.grvmagc_27_x64.angle", __pyx_clineno, __pyx_lineno, __pyx_filename, 0);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line217")'> 217:                          double Un[3], double flimit):</pre>
<pre id='line217' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line218")'> 218:     """Angle.m finds the angle between planes O-p1-p2 and O-p2-p3 where p1</pre>
<pre id='line218' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line219")'> 219:     p2 p3 are coordinates of three points taken in ccw order as seen from the</pre>
<pre id='line219' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line220")'> 220:     origin O.</pre>
<pre id='line220' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line221")'> 221:     This is used by gm3d for finding the solid angle subtended by a</pre>
<pre id='line221' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line222")'> 222:     polygon at the origin. Un is the unit outward normal vector to the polygon.</pre>
<pre id='line222' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line223")'> 223:     """</pre>
<pre id='line223' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line224")'> 224: </pre>
<pre id='line224' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line225")'> 225:     cdef double anout</pre>
<pre id='line225' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line226")'> 226:     cdef double pn1</pre>
<pre id='line226' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line227")'> 227:     cdef double pn2</pre>
<pre id='line227' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line228")'> 228:     cdef double ang</pre>
<pre id='line228' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line229")'> 229:     cdef double perp</pre>
<pre id='line229' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line230")'> 230:     cdef double r</pre>
<pre id='line230' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line231")'> 231:     cdef double n10</pre>
<pre id='line231' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line232")'> 232:     cdef double n11</pre>
<pre id='line232' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line233")'> 233:     cdef double n12</pre>
<pre id='line233' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line234")'> 234:     cdef double n20</pre>
<pre id='line234' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line235")'> 235:     cdef double n21</pre>
<pre id='line235' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line236")'> 236:     cdef double n22</pre>
<pre id='line236' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line237")'> 237: </pre>
<pre id='line237' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line238")'> 238:     ang = 0</pre>
<pre id='line238' class='code' style='background-color: #FFFFff'>  __pyx_v_ang = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line239")'> 239:     anout = dot(p1, Un)</pre>
<pre id='line239' class='code' style='background-color: #FFFFff'>  __pyx_v_anout = __pyx_f_8packages_5pfmod_14grvmagc_27_x64_dot(__pyx_v_p1, __pyx_v_Un);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line240")'> 240: </pre>
<pre id='line240' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line241")'> 241:     if abs(anout) &lt;= flimit:</pre>
<pre id='line241' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = ((fabs(__pyx_v_anout) &lt;= __pyx_v_flimit) != 0);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line242")'> 242:         return 0</pre>
<pre id='line242' class='code' style='background-color: #FFFFff'>    __pyx_r = 0.0;
    goto __pyx_L0;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line243")'> 243: </pre>
<pre id='line243' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line244")'> 244:     if anout &gt; flimit:    # face seen from inside, interchange p1 and p3</pre>
<pre id='line244' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = ((__pyx_v_anout &gt; __pyx_v_flimit) != 0);
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line245")'> 245:         p1, p3 = p3, p1</pre>
<pre id='line245' class='code' style='background-color: #FFFFff'>    __pyx_t_2 = __pyx_v_p3;
    __pyx_t_3 = __pyx_v_p1;
    __pyx_v_p1 = __pyx_t_2;
    __pyx_v_p3 = __pyx_t_3;
    goto __pyx_L4;
  }
  __pyx_L4:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line246")'> 246: </pre>
<pre id='line246' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line247")'> 247:     n10 = p2[1]*p1[2] - p2[2]*p1[1]</pre>
<pre id='line247' class='code' style='background-color: #FFFFff'>  __pyx_v_n10 = (((__pyx_v_p2[1]) * (__pyx_v_p1[2])) - ((__pyx_v_p2[2]) * (__pyx_v_p1[1])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line248")'> 248:     n11 = p2[2]*p1[0] - p2[0]*p1[2]</pre>
<pre id='line248' class='code' style='background-color: #FFFFff'>  __pyx_v_n11 = (((__pyx_v_p2[2]) * (__pyx_v_p1[0])) - ((__pyx_v_p2[0]) * (__pyx_v_p1[2])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line249")'> 249:     n12 = p2[0]*p1[1] - p2[1]*p1[0]</pre>
<pre id='line249' class='code' style='background-color: #FFFFff'>  __pyx_v_n12 = (((__pyx_v_p2[0]) * (__pyx_v_p1[1])) - ((__pyx_v_p2[1]) * (__pyx_v_p1[0])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line250")'> 250: </pre>
<pre id='line250' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line251")'> 251:     n20 = p2[1]*p3[2] - p2[2]*p3[1]</pre>
<pre id='line251' class='code' style='background-color: #FFFFff'>  __pyx_v_n20 = (((__pyx_v_p2[1]) * (__pyx_v_p3[2])) - ((__pyx_v_p2[2]) * (__pyx_v_p3[1])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line252")'> 252:     n21 = p2[2]*p3[0] - p2[0]*p3[2]</pre>
<pre id='line252' class='code' style='background-color: #FFFFff'>  __pyx_v_n21 = (((__pyx_v_p2[2]) * (__pyx_v_p3[0])) - ((__pyx_v_p2[0]) * (__pyx_v_p3[2])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line253")'> 253:     n22 = p2[0]*p3[1] - p2[1]*p3[0]</pre>
<pre id='line253' class='code' style='background-color: #FFFFff'>  __pyx_v_n22 = (((__pyx_v_p2[0]) * (__pyx_v_p3[1])) - ((__pyx_v_p2[1]) * (__pyx_v_p3[0])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line254")'> 254: </pre>
<pre id='line254' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line255")'> 255:     pn1 = sqrt(n10*n10+n11*n11+n12*n12)</pre>
<pre id='line255' class='code' style='background-color: #FFFFff'>  __pyx_v_pn1 = sqrt((((__pyx_v_n10 * __pyx_v_n10) + (__pyx_v_n11 * __pyx_v_n11)) + (__pyx_v_n12 * __pyx_v_n12)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line256")'> 256:     pn2 = sqrt(n20*n20+n21*n21+n22*n22)</pre>
<pre id='line256' class='code' style='background-color: #FFFFff'>  __pyx_v_pn2 = sqrt((((__pyx_v_n20 * __pyx_v_n20) + (__pyx_v_n21 * __pyx_v_n21)) + (__pyx_v_n22 * __pyx_v_n22)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line257")'> 257: </pre>
<pre id='line257' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line258")'> 258:     if (pn1 &lt;= flimit) or (pn2 &lt;= flimit):</pre>
<pre id='line258' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = ((__pyx_v_pn1 &lt;= __pyx_v_flimit) != 0);
  if (!__pyx_t_1) {
    __pyx_t_4 = ((__pyx_v_pn2 &lt;= __pyx_v_flimit) != 0);
    __pyx_t_5 = __pyx_t_4;
  } else {
    __pyx_t_5 = __pyx_t_1;
  }
  if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line259")'> 259:         ang = np.nan</pre>
<pre id='line259' class='code' style='background-color: #FFFF79'>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_nan);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_7);<span class='error_goto'> if (unlikely((__pyx_t_8 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_v_ang = __pyx_t_8;
    goto __pyx_L5;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line260")'> 260:     else:</pre>
<pre id='line260' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line261")'> 261:         n10 = n10/pn1</pre>
<pre id='line261' class='code' style='background-color: #FFFFaa'>    if (unlikely(__pyx_v_pn1 == 0)) {
      #ifdef WITH_THREAD
      PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
      #endif
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      #ifdef WITH_THREAD
      PyGILState_Release(__pyx_gilstate_save);
      #endif
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_n10 = (__pyx_v_n10 / __pyx_v_pn1);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line262")'> 262:         n11 = n11/pn1</pre>
<pre id='line262' class='code' style='background-color: #FFFFaa'>    if (unlikely(__pyx_v_pn1 == 0)) {
      #ifdef WITH_THREAD
      PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
      #endif
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      #ifdef WITH_THREAD
      PyGILState_Release(__pyx_gilstate_save);
      #endif
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_n11 = (__pyx_v_n11 / __pyx_v_pn1);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line263")'> 263:         n12 = n12/pn1</pre>
<pre id='line263' class='code' style='background-color: #FFFFaa'>    if (unlikely(__pyx_v_pn1 == 0)) {
      #ifdef WITH_THREAD
      PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
      #endif
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      #ifdef WITH_THREAD
      PyGILState_Release(__pyx_gilstate_save);
      #endif
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_n12 = (__pyx_v_n12 / __pyx_v_pn1);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line264")'> 264:         n20 = n20/pn2</pre>
<pre id='line264' class='code' style='background-color: #FFFFaa'>    if (unlikely(__pyx_v_pn2 == 0)) {
      #ifdef WITH_THREAD
      PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
      #endif
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      #ifdef WITH_THREAD
      PyGILState_Release(__pyx_gilstate_save);
      #endif
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_n20 = (__pyx_v_n20 / __pyx_v_pn2);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line265")'> 265:         n21 = n21/pn2</pre>
<pre id='line265' class='code' style='background-color: #FFFFaa'>    if (unlikely(__pyx_v_pn2 == 0)) {
      #ifdef WITH_THREAD
      PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
      #endif
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      #ifdef WITH_THREAD
      PyGILState_Release(__pyx_gilstate_save);
      #endif
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 265; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_n21 = (__pyx_v_n21 / __pyx_v_pn2);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line266")'> 266:         n22 = n22/pn2</pre>
<pre id='line266' class='code' style='background-color: #FFFFaa'>    if (unlikely(__pyx_v_pn2 == 0)) {
      #ifdef WITH_THREAD
      PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
      #endif
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      #ifdef WITH_THREAD
      PyGILState_Release(__pyx_gilstate_save);
      #endif
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_n22 = (__pyx_v_n22 / __pyx_v_pn2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line267")'> 267: </pre>
<pre id='line267' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line268")'> 268:         r = n10*n20+n11*n21+n12*n22</pre>
<pre id='line268' class='code' style='background-color: #FFFFff'>    __pyx_v_r = (((__pyx_v_n10 * __pyx_v_n20) + (__pyx_v_n11 * __pyx_v_n21)) + (__pyx_v_n12 * __pyx_v_n22));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line269")'> 269:         ang = acos(r)</pre>
<pre id='line269' class='code' style='background-color: #FFFFff'>    __pyx_v_ang = acos(__pyx_v_r);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line270")'> 270: </pre>
<pre id='line270' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line271")'> 271:         perp = n10*p3[0]+n11*p3[1]+n12*p3[2]</pre>
<pre id='line271' class='code' style='background-color: #FFFFff'>    __pyx_v_perp = (((__pyx_v_n10 * (__pyx_v_p3[0])) + (__pyx_v_n11 * (__pyx_v_p3[1]))) + (__pyx_v_n12 * (__pyx_v_p3[2])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line272")'> 272: </pre>
<pre id='line272' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line273")'> 273:         if perp &lt; -flimit:        # points p1,p2,p3 in cw order</pre>
<pre id='line273' class='code' style='background-color: #FFFFff'>    __pyx_t_5 = ((__pyx_v_perp &lt; (-__pyx_v_flimit)) != 0);
    if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line274")'> 274:             ang = 2*pi-ang</pre>
<pre id='line274' class='code' style='background-color: #FFFFff'>      __pyx_v_ang = ((2.0 * 3.141592653589793) - __pyx_v_ang);
      goto __pyx_L6;
    }
    __pyx_L6:;
  }
  __pyx_L5:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line275")'> 275: </pre>
<pre id='line275' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line276")'> 276: ##    if anout &gt; flimit:    # face seen from inside, interchange p1 and p3</pre>
<pre id='line276' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line277")'> 277: ##        p3, p1 = p1, p3</pre>
<pre id='line277' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line278")'> 278: </pre>
<pre id='line278' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line279")'> 279:     return ang</pre>
<pre id='line279' class='code' style='background-color: #FFFFff'>  __pyx_r = __pyx_v_ang;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line280")'> 280: </pre>
<pre id='line280' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line281")'> 281: </pre>
<pre id='line281' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF09' onclick='toggleDiv("line282")'> 282: def calc_field2(int i, int numx, int numy, int numz,</pre>
<pre id='line282' class='code' style='background-color: #FFFF09'>/* Python wrapper */
static PyObject *__pyx_pw_8packages_5pfmod_14grvmagc_27_x64_3calc_field2(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8packages_5pfmod_14grvmagc_27_x64_2calc_field2[] = " Calculate magnetic and gravity field ";
static PyMethodDef __pyx_mdef_8packages_5pfmod_14grvmagc_27_x64_3calc_field2 = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("calc_field2"), (PyCFunction)__pyx_pw_8packages_5pfmod_14grvmagc_27_x64_3calc_field2, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_8packages_5pfmod_14grvmagc_27_x64_2calc_field2)};
static PyObject *__pyx_pw_8packages_5pfmod_14grvmagc_27_x64_3calc_field2(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_i;
  int __pyx_v_numx;
  int __pyx_v_numy;
  int __pyx_v_numz;
  PyArrayObject *__pyx_v_modind = 0;
  PyArrayObject *__pyx_v_hcor = 0;
  PyArrayObject *__pyx_v_aaa0 = 0;
  PyArrayObject *__pyx_v_aaa1 = 0;
  PyArrayObject *__pyx_v_mlayers = 0;
  PyArrayObject *__pyx_v_glayers = 0;
  PyArrayObject *__pyx_v_magval = 0;
  PyArrayObject *__pyx_v_grvval = 0;
  PyArrayObject *__pyx_v_hcorflat = 0;
  int __pyx_v_mijk;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("calc_field2 (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_i,&amp;__pyx_n_s_numx,&amp;__pyx_n_s_numy,&amp;__pyx_n_s_numz,&amp;__pyx_n_s_modind,&amp;__pyx_n_s_hcor,&amp;__pyx_n_s_aaa0,&amp;__pyx_n_s_aaa1,&amp;__pyx_n_s_mlayers,&amp;__pyx_n_s_glayers,&amp;__pyx_n_s_magval,&amp;__pyx_n_s_grvval,&amp;__pyx_n_s_hcorflat,&amp;__pyx_n_s_mijk,0};
    PyObject* values[14] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_i)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_numx)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_field2", 1, 14, 14, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_numy)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_field2", 1, 14, 14, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_numz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_field2", 1, 14, 14, 3); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        if (likely((values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_modind)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_field2", 1, 14, 14, 4); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  5:
        if (likely((values[5] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_hcor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_field2", 1, 14, 14, 5); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  6:
        if (likely((values[6] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_aaa0)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_field2", 1, 14, 14, 6); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  7:
        if (likely((values[7] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_aaa1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_field2", 1, 14, 14, 7); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  8:
        if (likely((values[8] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_mlayers)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_field2", 1, 14, 14, 8); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  9:
        if (likely((values[9] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_glayers)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_field2", 1, 14, 14, 9); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 10:
        if (likely((values[10] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_magval)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_field2", 1, 14, 14, 10); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 11:
        if (likely((values[11] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_grvval)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_field2", 1, 14, 14, 11); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 12:
        if (likely((values[12] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_hcorflat)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_field2", 1, 14, 14, 12); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 13:
        if (likely((values[13] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_mijk)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_field2", 1, 14, 14, 13); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "calc_field2") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 14) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
      values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
      values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
      values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
      values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
      values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
      values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
      values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
    }
    __pyx_v_i = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_i == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_numx = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_numx == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_numy = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[2]);<span class='error_goto'> if (unlikely((__pyx_v_numy == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_numz = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[3]);<span class='error_goto'> if (unlikely((__pyx_v_numz == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_modind = ((PyArrayObject *)values[4]);
    __pyx_v_hcor = ((PyArrayObject *)values[5]);
    __pyx_v_aaa0 = ((PyArrayObject *)values[6]);
    __pyx_v_aaa1 = ((PyArrayObject *)values[7]);
    __pyx_v_mlayers = ((PyArrayObject *)values[8]);
    __pyx_v_glayers = ((PyArrayObject *)values[9]);
    __pyx_v_magval = ((PyArrayObject *)values[10]);
    __pyx_v_grvval = ((PyArrayObject *)values[11]);
    __pyx_v_hcorflat = ((PyArrayObject *)values[12]);
    __pyx_v_mijk = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[13]);<span class='error_goto'> if (unlikely((__pyx_v_mijk == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_field2", 1, 14, 14, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("packages.pfmod.grvmagc_27_x64.calc_field2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_modind), __pyx_ptype_5numpy_ndarray, 1, "modind", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_hcor), __pyx_ptype_5numpy_ndarray, 1, "hcor", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_aaa0), __pyx_ptype_5numpy_ndarray, 1, "aaa0", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 285; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_aaa1), __pyx_ptype_5numpy_ndarray, 1, "aaa1", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_mlayers), __pyx_ptype_5numpy_ndarray, 1, "mlayers", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_glayers), __pyx_ptype_5numpy_ndarray, 1, "glayers", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_magval), __pyx_ptype_5numpy_ndarray, 1, "magval", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 289; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_grvval), __pyx_ptype_5numpy_ndarray, 1, "grvval", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_hcorflat), __pyx_ptype_5numpy_ndarray, 1, "hcorflat", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_8packages_5pfmod_14grvmagc_27_x64_2calc_field2(__pyx_self, __pyx_v_i, __pyx_v_numx, __pyx_v_numy, __pyx_v_numz, __pyx_v_modind, __pyx_v_hcor, __pyx_v_aaa0, __pyx_v_aaa1, __pyx_v_mlayers, __pyx_v_glayers, __pyx_v_magval, __pyx_v_grvval, __pyx_v_hcorflat, __pyx_v_mijk);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_8packages_5pfmod_14grvmagc_27_x64_2calc_field2(CYTHON_UNUSED PyObject *__pyx_self, int __pyx_v_i, int __pyx_v_numx, int __pyx_v_numy, int __pyx_v_numz, PyArrayObject *__pyx_v_modind, PyArrayObject *__pyx_v_hcor, PyArrayObject *__pyx_v_aaa0, PyArrayObject *__pyx_v_aaa1, PyArrayObject *__pyx_v_mlayers, PyArrayObject *__pyx_v_glayers, PyArrayObject *__pyx_v_magval, PyArrayObject *__pyx_v_grvval, PyArrayObject *__pyx_v_hcorflat, int __pyx_v_mijk) {
  int __pyx_v_xoff;
  int __pyx_v_yoff;
  int __pyx_v_j;
  int __pyx_v_k;
  int __pyx_v_ijk;
  PyArrayObject *__pyx_v_obs2 = 0;
  PyArrayObject *__pyx_v_m2 = 0;
  PyArrayObject *__pyx_v_g2 = 0;
  int __pyx_v_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_aaa0;
  __Pyx_Buffer __pyx_pybuffer_aaa0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_aaa1;
  __Pyx_Buffer __pyx_pybuffer_aaa1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g2;
  __Pyx_Buffer __pyx_pybuffer_g2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_glayers;
  __Pyx_Buffer __pyx_pybuffer_glayers;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_grvval;
  __Pyx_Buffer __pyx_pybuffer_grvval;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_hcor;
  __Pyx_Buffer __pyx_pybuffer_hcor;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_hcorflat;
  __Pyx_Buffer __pyx_pybuffer_hcorflat;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_m2;
  __Pyx_Buffer __pyx_pybuffer_m2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_magval;
  __Pyx_Buffer __pyx_pybuffer_magval;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_mlayers;
  __Pyx_Buffer __pyx_pybuffer_mlayers;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_modind;
  __Pyx_Buffer __pyx_pybuffer_modind;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_obs2;
  __Pyx_Buffer __pyx_pybuffer_obs2;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("calc_field2", 0);
  __pyx_pybuffer_obs2.pybuffer.buf = NULL;
  __pyx_pybuffer_obs2.refcount = 0;
  __pyx_pybuffernd_obs2.data = NULL;
  __pyx_pybuffernd_obs2.rcbuffer = &amp;__pyx_pybuffer_obs2;
  __pyx_pybuffer_m2.pybuffer.buf = NULL;
  __pyx_pybuffer_m2.refcount = 0;
  __pyx_pybuffernd_m2.data = NULL;
  __pyx_pybuffernd_m2.rcbuffer = &amp;__pyx_pybuffer_m2;
  __pyx_pybuffer_g2.pybuffer.buf = NULL;
  __pyx_pybuffer_g2.refcount = 0;
  __pyx_pybuffernd_g2.data = NULL;
  __pyx_pybuffernd_g2.rcbuffer = &amp;__pyx_pybuffer_g2;
  __pyx_pybuffer_modind.pybuffer.buf = NULL;
  __pyx_pybuffer_modind.refcount = 0;
  __pyx_pybuffernd_modind.data = NULL;
  __pyx_pybuffernd_modind.rcbuffer = &amp;__pyx_pybuffer_modind;
  __pyx_pybuffer_hcor.pybuffer.buf = NULL;
  __pyx_pybuffer_hcor.refcount = 0;
  __pyx_pybuffernd_hcor.data = NULL;
  __pyx_pybuffernd_hcor.rcbuffer = &amp;__pyx_pybuffer_hcor;
  __pyx_pybuffer_aaa0.pybuffer.buf = NULL;
  __pyx_pybuffer_aaa0.refcount = 0;
  __pyx_pybuffernd_aaa0.data = NULL;
  __pyx_pybuffernd_aaa0.rcbuffer = &amp;__pyx_pybuffer_aaa0;
  __pyx_pybuffer_aaa1.pybuffer.buf = NULL;
  __pyx_pybuffer_aaa1.refcount = 0;
  __pyx_pybuffernd_aaa1.data = NULL;
  __pyx_pybuffernd_aaa1.rcbuffer = &amp;__pyx_pybuffer_aaa1;
  __pyx_pybuffer_mlayers.pybuffer.buf = NULL;
  __pyx_pybuffer_mlayers.refcount = 0;
  __pyx_pybuffernd_mlayers.data = NULL;
  __pyx_pybuffernd_mlayers.rcbuffer = &amp;__pyx_pybuffer_mlayers;
  __pyx_pybuffer_glayers.pybuffer.buf = NULL;
  __pyx_pybuffer_glayers.refcount = 0;
  __pyx_pybuffernd_glayers.data = NULL;
  __pyx_pybuffernd_glayers.rcbuffer = &amp;__pyx_pybuffer_glayers;
  __pyx_pybuffer_magval.pybuffer.buf = NULL;
  __pyx_pybuffer_magval.refcount = 0;
  __pyx_pybuffernd_magval.data = NULL;
  __pyx_pybuffernd_magval.rcbuffer = &amp;__pyx_pybuffer_magval;
  __pyx_pybuffer_grvval.pybuffer.buf = NULL;
  __pyx_pybuffer_grvval.refcount = 0;
  __pyx_pybuffernd_grvval.data = NULL;
  __pyx_pybuffernd_grvval.rcbuffer = &amp;__pyx_pybuffer_grvval;
  __pyx_pybuffer_hcorflat.pybuffer.buf = NULL;
  __pyx_pybuffer_hcorflat.refcount = 0;
  __pyx_pybuffernd_hcorflat.data = NULL;
  __pyx_pybuffernd_hcorflat.rcbuffer = &amp;__pyx_pybuffer_hcorflat;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_modind.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_modind, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_modind.diminfo[0].strides = __pyx_pybuffernd_modind.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_modind.diminfo[0].shape = __pyx_pybuffernd_modind.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_modind.diminfo[1].strides = __pyx_pybuffernd_modind.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_modind.diminfo[1].shape = __pyx_pybuffernd_modind.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_modind.diminfo[2].strides = __pyx_pybuffernd_modind.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_modind.diminfo[2].shape = __pyx_pybuffernd_modind.rcbuffer-&gt;pybuffer.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_hcor.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_hcor, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_hcor.diminfo[0].strides = __pyx_pybuffernd_hcor.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_hcor.diminfo[0].shape = __pyx_pybuffernd_hcor.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_hcor.diminfo[1].strides = __pyx_pybuffernd_hcor.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_hcor.diminfo[1].shape = __pyx_pybuffernd_hcor.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_aaa0.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_aaa0, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_aaa0.diminfo[0].strides = __pyx_pybuffernd_aaa0.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_aaa0.diminfo[0].shape = __pyx_pybuffernd_aaa0.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_aaa1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_aaa1, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_aaa1.diminfo[0].strides = __pyx_pybuffernd_aaa1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_aaa1.diminfo[0].shape = __pyx_pybuffernd_aaa1.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mlayers.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_mlayers, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_mlayers.diminfo[0].strides = __pyx_pybuffernd_mlayers.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_mlayers.diminfo[0].shape = __pyx_pybuffernd_mlayers.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_mlayers.diminfo[1].strides = __pyx_pybuffernd_mlayers.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_mlayers.diminfo[1].shape = __pyx_pybuffernd_mlayers.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_mlayers.diminfo[2].strides = __pyx_pybuffernd_mlayers.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_mlayers.diminfo[2].shape = __pyx_pybuffernd_mlayers.rcbuffer-&gt;pybuffer.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_glayers.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_glayers, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_glayers.diminfo[0].strides = __pyx_pybuffernd_glayers.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_glayers.diminfo[0].shape = __pyx_pybuffernd_glayers.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_glayers.diminfo[1].strides = __pyx_pybuffernd_glayers.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_glayers.diminfo[1].shape = __pyx_pybuffernd_glayers.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_glayers.diminfo[2].strides = __pyx_pybuffernd_glayers.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_glayers.diminfo[2].shape = __pyx_pybuffernd_glayers.rcbuffer-&gt;pybuffer.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_magval.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_magval, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_magval.diminfo[0].strides = __pyx_pybuffernd_magval.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_magval.diminfo[0].shape = __pyx_pybuffernd_magval.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_grvval.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_grvval, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_grvval.diminfo[0].strides = __pyx_pybuffernd_grvval.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_grvval.diminfo[0].shape = __pyx_pybuffernd_grvval.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_hcorflat.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_hcorflat, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_hcorflat.diminfo[0].strides = __pyx_pybuffernd_hcorflat.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_hcorflat.diminfo[0].shape = __pyx_pybuffernd_hcorflat.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_aaa0.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_aaa1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_g2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_glayers.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_grvval.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_hcor.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_hcorflat.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_m2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_magval.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mlayers.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_modind.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_obs2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("packages.pfmod.grvmagc_27_x64.calc_field2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_aaa0.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_aaa1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_g2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_glayers.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_grvval.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_hcor.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_hcorflat.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_m2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_magval.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mlayers.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_modind.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_obs2.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_obs2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_m2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_g2);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__12 = <span class='py_c_api'>PyTuple_Pack</span>(25, __pyx_n_s_i, __pyx_n_s_numx, __pyx_n_s_numy, __pyx_n_s_numz, __pyx_n_s_modind, __pyx_n_s_hcor, __pyx_n_s_aaa0, __pyx_n_s_aaa1, __pyx_n_s_mlayers, __pyx_n_s_glayers, __pyx_n_s_magval, __pyx_n_s_grvval, __pyx_n_s_hcorflat, __pyx_n_s_mijk, __pyx_n_s_xoff, __pyx_n_s_yoff, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_ijk, __pyx_n_s_igrd, __pyx_n_s_jgrd, __pyx_n_s_obs2, __pyx_n_s_m2, __pyx_n_s_g2, __pyx_n_s_b);<span class='error_goto'> if (unlikely(!__pyx_tuple__12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__12);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__12);
/* … */
  __pyx_t_2 = PyCFunction_NewEx(&amp;__pyx_mdef_8packages_5pfmod_14grvmagc_27_x64_3calc_field2, NULL, __pyx_n_s_packages_pfmod_grvmagc_27_x64);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_calc_field2, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_codeobj__13 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(14, 0, 25, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__12, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_C_Work_Programming_PyGMI2_packag, __pyx_n_s_calc_field2, 282, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line283")'> 283:                 np.ndarray[DTYPEI_t, ndim=3] modind,</pre>
<pre id='line283' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line284")'> 284:                 np.ndarray[DTYPEI_t, ndim=2] hcor,</pre>
<pre id='line284' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line285")'> 285:                 np.ndarray[DTYPEI_t, ndim=1] aaa0,</pre>
<pre id='line285' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line286")'> 286:                 np.ndarray[DTYPEI_t, ndim=1] aaa1,</pre>
<pre id='line286' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line287")'> 287:                 np.ndarray[DTYPED_t, ndim=3] mlayers,</pre>
<pre id='line287' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line288")'> 288:                 np.ndarray[DTYPED_t, ndim=3] glayers,</pre>
<pre id='line288' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line289")'> 289:                 np.ndarray[DTYPED_t, ndim=1] magval,</pre>
<pre id='line289' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line290")'> 290:                 np.ndarray[DTYPED_t, ndim=1] grvval,</pre>
<pre id='line290' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line291")'> 291:                 np.ndarray[DTYPEI_t, ndim=1] hcorflat,</pre>
<pre id='line291' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line292")'> 292:                 int mijk):</pre>
<pre id='line292' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line293")'> 293:     """ Calculate magnetic and gravity field """</pre>
<pre id='line293' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line294")'> 294: </pre>
<pre id='line294' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line295")'> 295:     cdef int xoff</pre>
<pre id='line295' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line296")'> 296:     cdef int yoff</pre>
<pre id='line296' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line297")'> 297:     cdef int j</pre>
<pre id='line297' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line298")'> 298:     cdef int k</pre>
<pre id='line298' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line299")'> 299:     cdef int ijk</pre>
<pre id='line299' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line300")'> 300:     cdef int igrd</pre>
<pre id='line300' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line301")'> 301:     cdef int jgrd</pre>
<pre id='line301' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line302")'> 302:     cdef np.ndarray[DTYPEI_t, ndim = 1] obs2</pre>
<pre id='line302' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line303")'> 303:     cdef np.ndarray[DTYPED_t, ndim = 3] m2</pre>
<pre id='line303' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line304")'> 304:     cdef np.ndarray[DTYPED_t, ndim = 3] g2</pre>
<pre id='line304' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line305")'> 305:     cdef int b</pre>
<pre id='line305' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line306")'> 306: </pre>
<pre id='line306' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line307")'> 307:     b = magval.size</pre>
<pre id='line307' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_magval), __pyx_n_s_size);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 307; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 307; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_b = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line308")'> 308: </pre>
<pre id='line308' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line309")'> 309:     xoff = numx-i</pre>
<pre id='line309' class='code' style='background-color: #FFFFff'>  __pyx_v_xoff = (__pyx_v_numx - __pyx_v_i);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line310")'> 310:     for j in range(numy):</pre>
<pre id='line310' class='code' style='background-color: #FFFFff'>  __pyx_t_2 = __pyx_v_numy;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_j = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line311")'> 311:         yoff = numy-j</pre>
<pre id='line311' class='code' style='background-color: #FFFFff'>    __pyx_v_yoff = (__pyx_v_numy - __pyx_v_j);
</pre><pre class='line' style='background-color: #FFFF22' onclick='toggleDiv("line312")'> 312:         m2 = mlayers[:, xoff:xoff+numx, yoff:yoff+numy]</pre>
<pre id='line312' class='code' style='background-color: #FFFF22'>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_xoff);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>((__pyx_v_xoff + __pyx_v_numx));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_5 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_1, __pyx_t_4, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_yoff);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>((__pyx_v_yoff + __pyx_v_numy));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_6 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_4, __pyx_t_1, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_slice__2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_5);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, __pyx_t_6);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    __pyx_t_5 = 0;
    __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_mlayers), __pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_6 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_7 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_m2.rcbuffer-&gt;pybuffer);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_m2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_7, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_9, &amp;__pyx_t_10, &amp;__pyx_t_11);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_m2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_m2, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
        }
      }
      __pyx_pybuffernd_m2.diminfo[0].strides = __pyx_pybuffernd_m2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_m2.diminfo[0].shape = __pyx_pybuffernd_m2.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_m2.diminfo[1].strides = __pyx_pybuffernd_m2.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_m2.diminfo[1].shape = __pyx_pybuffernd_m2.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_m2.diminfo[2].strides = __pyx_pybuffernd_m2.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_m2.diminfo[2].shape = __pyx_pybuffernd_m2.rcbuffer-&gt;pybuffer.shape[2];
      if (unlikely(__pyx_t_8 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_m2, ((PyArrayObject *)__pyx_t_6));
    __pyx_t_6 = 0;
/* … */
  __pyx_slice__2 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__2);
</pre><pre class='line' style='background-color: #FFFF22' onclick='toggleDiv("line313")'> 313:         g2 = glayers[:, xoff:xoff+numx, yoff:yoff+numy]</pre>
<pre id='line313' class='code' style='background-color: #FFFF22'>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_xoff);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>((__pyx_v_xoff + __pyx_v_numx));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_6, __pyx_t_1, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_yoff);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>((__pyx_v_yoff + __pyx_v_numy));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_4 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_1, __pyx_t_6, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_slice__3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_5);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 2, __pyx_t_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    __pyx_t_5 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_glayers), __pyx_t_6);<span class='error_goto'> if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_12 = ((PyArrayObject *)__pyx_t_4);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_g2.rcbuffer-&gt;pybuffer);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_g2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_12, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_11, &amp;__pyx_t_10, &amp;__pyx_t_9);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_g2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_g2, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_11, __pyx_t_10, __pyx_t_9);
        }
      }
      __pyx_pybuffernd_g2.diminfo[0].strides = __pyx_pybuffernd_g2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_g2.diminfo[0].shape = __pyx_pybuffernd_g2.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_g2.diminfo[1].strides = __pyx_pybuffernd_g2.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_g2.diminfo[1].shape = __pyx_pybuffernd_g2.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_g2.diminfo[2].strides = __pyx_pybuffernd_g2.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_g2.diminfo[2].shape = __pyx_pybuffernd_g2.rcbuffer-&gt;pybuffer.shape[2];
      if (unlikely(__pyx_t_8 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_12 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_g2, ((PyArrayObject *)__pyx_t_4));
    __pyx_t_4 = 0;
/* … */
  __pyx_slice__3 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__3);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line314")'> 314:         for k in range(hcor[i, j], numz):</pre>
<pre id='line314' class='code' style='background-color: #FFFFd4'>    __pyx_t_8 = __pyx_v_numz;
    __pyx_t_13 = __pyx_v_i;
    __pyx_t_14 = __pyx_v_j;
    __pyx_t_15 = -1;
    if (__pyx_t_13 &lt; 0) {
      __pyx_t_13 += __pyx_pybuffernd_hcor.diminfo[0].shape;
      if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_15 = 0;
    } else if (unlikely(__pyx_t_13 &gt;= __pyx_pybuffernd_hcor.diminfo[0].shape)) __pyx_t_15 = 0;
    if (__pyx_t_14 &lt; 0) {
      __pyx_t_14 += __pyx_pybuffernd_hcor.diminfo[1].shape;
      if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_15 = 1;
    } else if (unlikely(__pyx_t_14 &gt;= __pyx_pybuffernd_hcor.diminfo[1].shape)) __pyx_t_15 = 1;
    if (unlikely(__pyx_t_15 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_15);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    for (__pyx_t_15 = (*__Pyx_BufPtrStrided2d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t *, __pyx_pybuffernd_hcor.rcbuffer-&gt;pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_hcor.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_hcor.diminfo[1].strides)); __pyx_t_15 &lt; __pyx_t_8; __pyx_t_15+=1) {
      __pyx_v_k = __pyx_t_15;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line315")'> 315:             if (modind[i, j, k] != mijk):</pre>
<pre id='line315' class='code' style='background-color: #FFFFd4'>      __pyx_t_16 = __pyx_v_i;
      __pyx_t_17 = __pyx_v_j;
      __pyx_t_18 = __pyx_v_k;
      __pyx_t_19 = -1;
      if (__pyx_t_16 &lt; 0) {
        __pyx_t_16 += __pyx_pybuffernd_modind.diminfo[0].shape;
        if (unlikely(__pyx_t_16 &lt; 0)) __pyx_t_19 = 0;
      } else if (unlikely(__pyx_t_16 &gt;= __pyx_pybuffernd_modind.diminfo[0].shape)) __pyx_t_19 = 0;
      if (__pyx_t_17 &lt; 0) {
        __pyx_t_17 += __pyx_pybuffernd_modind.diminfo[1].shape;
        if (unlikely(__pyx_t_17 &lt; 0)) __pyx_t_19 = 1;
      } else if (unlikely(__pyx_t_17 &gt;= __pyx_pybuffernd_modind.diminfo[1].shape)) __pyx_t_19 = 1;
      if (__pyx_t_18 &lt; 0) {
        __pyx_t_18 += __pyx_pybuffernd_modind.diminfo[2].shape;
        if (unlikely(__pyx_t_18 &lt; 0)) __pyx_t_19 = 2;
      } else if (unlikely(__pyx_t_18 &gt;= __pyx_pybuffernd_modind.diminfo[2].shape)) __pyx_t_19 = 2;
      if (unlikely(__pyx_t_19 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_19);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_20 = (((*__Pyx_BufPtrStrided3d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t *, __pyx_pybuffernd_modind.rcbuffer-&gt;pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_modind.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_modind.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_modind.diminfo[2].strides)) != __pyx_v_mijk) != 0);
      if (__pyx_t_20) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line316")'> 316:                 continue</pre>
<pre id='line316' class='code' style='background-color: #FFFFff'>        goto __pyx_L5_continue;
      }
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line317")'> 317:             obs2 = k+hcorflat</pre>
<pre id='line317' class='code' style='background-color: #FFFF41'>      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_k);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_4, ((PyObject *)__pyx_v_hcorflat));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_21 = ((PyArrayObject *)__pyx_t_6);
      {
        __Pyx_BufFmt_StackElem __pyx_stack[1];
        <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_obs2.rcbuffer-&gt;pybuffer);
        __pyx_t_19 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_obs2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_21, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
        if (unlikely(__pyx_t_19 &lt; 0)) {
          <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_9, &amp;__pyx_t_10, &amp;__pyx_t_11);
          if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_obs2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_obs2, &amp;__Pyx_TypeInfo_nn___pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
            Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
            <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
          } else {
            <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
          }
        }
        __pyx_pybuffernd_obs2.diminfo[0].strides = __pyx_pybuffernd_obs2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_obs2.diminfo[0].shape = __pyx_pybuffernd_obs2.rcbuffer-&gt;pybuffer.shape[0];
        if (unlikely(__pyx_t_19 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_21 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_obs2, ((PyArrayObject *)__pyx_t_6));
      __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line318")'> 318:             for ijk in range(b):</pre>
<pre id='line318' class='code' style='background-color: #FFFFff'>      __pyx_t_19 = __pyx_v_b;
      for (__pyx_t_22 = 0; __pyx_t_22 &lt; __pyx_t_19; __pyx_t_22+=1) {
        __pyx_v_ijk = __pyx_t_22;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line319")'> 319:                 magval[ijk] += m2[obs2[ijk], aaa0[ijk], aaa1[ijk]]</pre>
<pre id='line319' class='code' style='background-color: #FFFF7f'>        __pyx_t_23 = __pyx_v_ijk;
        __pyx_t_24 = -1;
        if (__pyx_t_23 &lt; 0) {
          __pyx_t_23 += __pyx_pybuffernd_obs2.diminfo[0].shape;
          if (unlikely(__pyx_t_23 &lt; 0)) __pyx_t_24 = 0;
        } else if (unlikely(__pyx_t_23 &gt;= __pyx_pybuffernd_obs2.diminfo[0].shape)) __pyx_t_24 = 0;
        if (unlikely(__pyx_t_24 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_24);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 319; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_24 = __pyx_v_ijk;
        __pyx_t_25 = -1;
        if (__pyx_t_24 &lt; 0) {
          __pyx_t_24 += __pyx_pybuffernd_aaa0.diminfo[0].shape;
          if (unlikely(__pyx_t_24 &lt; 0)) __pyx_t_25 = 0;
        } else if (unlikely(__pyx_t_24 &gt;= __pyx_pybuffernd_aaa0.diminfo[0].shape)) __pyx_t_25 = 0;
        if (unlikely(__pyx_t_25 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_25);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 319; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_25 = __pyx_v_ijk;
        __pyx_t_26 = -1;
        if (__pyx_t_25 &lt; 0) {
          __pyx_t_25 += __pyx_pybuffernd_aaa1.diminfo[0].shape;
          if (unlikely(__pyx_t_25 &lt; 0)) __pyx_t_26 = 0;
        } else if (unlikely(__pyx_t_25 &gt;= __pyx_pybuffernd_aaa1.diminfo[0].shape)) __pyx_t_26 = 0;
        if (unlikely(__pyx_t_26 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_26);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 319; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_27 = (*__Pyx_BufPtrStrided1d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t *, __pyx_pybuffernd_obs2.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_obs2.diminfo[0].strides));
        __pyx_t_28 = (*__Pyx_BufPtrStrided1d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t *, __pyx_pybuffernd_aaa0.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_aaa0.diminfo[0].strides));
        __pyx_t_29 = (*__Pyx_BufPtrStrided1d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t *, __pyx_pybuffernd_aaa1.rcbuffer-&gt;pybuffer.buf, __pyx_t_25, __pyx_pybuffernd_aaa1.diminfo[0].strides));
        __pyx_t_26 = -1;
        if (__pyx_t_27 &lt; 0) {
          __pyx_t_27 += __pyx_pybuffernd_m2.diminfo[0].shape;
          if (unlikely(__pyx_t_27 &lt; 0)) __pyx_t_26 = 0;
        } else if (unlikely(__pyx_t_27 &gt;= __pyx_pybuffernd_m2.diminfo[0].shape)) __pyx_t_26 = 0;
        if (__pyx_t_28 &lt; 0) {
          __pyx_t_28 += __pyx_pybuffernd_m2.diminfo[1].shape;
          if (unlikely(__pyx_t_28 &lt; 0)) __pyx_t_26 = 1;
        } else if (unlikely(__pyx_t_28 &gt;= __pyx_pybuffernd_m2.diminfo[1].shape)) __pyx_t_26 = 1;
        if (__pyx_t_29 &lt; 0) {
          __pyx_t_29 += __pyx_pybuffernd_m2.diminfo[2].shape;
          if (unlikely(__pyx_t_29 &lt; 0)) __pyx_t_26 = 2;
        } else if (unlikely(__pyx_t_29 &gt;= __pyx_pybuffernd_m2.diminfo[2].shape)) __pyx_t_26 = 2;
        if (unlikely(__pyx_t_26 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_26);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 319; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_26 = __pyx_v_ijk;
        __pyx_t_30 = -1;
        if (__pyx_t_26 &lt; 0) {
          __pyx_t_26 += __pyx_pybuffernd_magval.diminfo[0].shape;
          if (unlikely(__pyx_t_26 &lt; 0)) __pyx_t_30 = 0;
        } else if (unlikely(__pyx_t_26 &gt;= __pyx_pybuffernd_magval.diminfo[0].shape)) __pyx_t_30 = 0;
        if (unlikely(__pyx_t_30 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_30);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 319; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        *__Pyx_BufPtrStrided1d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_magval.rcbuffer-&gt;pybuffer.buf, __pyx_t_26, __pyx_pybuffernd_magval.diminfo[0].strides) += (*__Pyx_BufPtrStrided3d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_m2.rcbuffer-&gt;pybuffer.buf, __pyx_t_27, __pyx_pybuffernd_m2.diminfo[0].strides, __pyx_t_28, __pyx_pybuffernd_m2.diminfo[1].strides, __pyx_t_29, __pyx_pybuffernd_m2.diminfo[2].strides));
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line320")'> 320:                 grvval[ijk] += g2[obs2[ijk], aaa0[ijk], aaa1[ijk]]</pre>
<pre id='line320' class='code' style='background-color: #FFFF7f'>        __pyx_t_30 = __pyx_v_ijk;
        __pyx_t_31 = -1;
        if (__pyx_t_30 &lt; 0) {
          __pyx_t_30 += __pyx_pybuffernd_obs2.diminfo[0].shape;
          if (unlikely(__pyx_t_30 &lt; 0)) __pyx_t_31 = 0;
        } else if (unlikely(__pyx_t_30 &gt;= __pyx_pybuffernd_obs2.diminfo[0].shape)) __pyx_t_31 = 0;
        if (unlikely(__pyx_t_31 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_31);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_31 = __pyx_v_ijk;
        __pyx_t_32 = -1;
        if (__pyx_t_31 &lt; 0) {
          __pyx_t_31 += __pyx_pybuffernd_aaa0.diminfo[0].shape;
          if (unlikely(__pyx_t_31 &lt; 0)) __pyx_t_32 = 0;
        } else if (unlikely(__pyx_t_31 &gt;= __pyx_pybuffernd_aaa0.diminfo[0].shape)) __pyx_t_32 = 0;
        if (unlikely(__pyx_t_32 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_32);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_32 = __pyx_v_ijk;
        __pyx_t_33 = -1;
        if (__pyx_t_32 &lt; 0) {
          __pyx_t_32 += __pyx_pybuffernd_aaa1.diminfo[0].shape;
          if (unlikely(__pyx_t_32 &lt; 0)) __pyx_t_33 = 0;
        } else if (unlikely(__pyx_t_32 &gt;= __pyx_pybuffernd_aaa1.diminfo[0].shape)) __pyx_t_33 = 0;
        if (unlikely(__pyx_t_33 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_33);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_34 = (*__Pyx_BufPtrStrided1d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t *, __pyx_pybuffernd_obs2.rcbuffer-&gt;pybuffer.buf, __pyx_t_30, __pyx_pybuffernd_obs2.diminfo[0].strides));
        __pyx_t_35 = (*__Pyx_BufPtrStrided1d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t *, __pyx_pybuffernd_aaa0.rcbuffer-&gt;pybuffer.buf, __pyx_t_31, __pyx_pybuffernd_aaa0.diminfo[0].strides));
        __pyx_t_36 = (*__Pyx_BufPtrStrided1d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPEI_t *, __pyx_pybuffernd_aaa1.rcbuffer-&gt;pybuffer.buf, __pyx_t_32, __pyx_pybuffernd_aaa1.diminfo[0].strides));
        __pyx_t_33 = -1;
        if (__pyx_t_34 &lt; 0) {
          __pyx_t_34 += __pyx_pybuffernd_g2.diminfo[0].shape;
          if (unlikely(__pyx_t_34 &lt; 0)) __pyx_t_33 = 0;
        } else if (unlikely(__pyx_t_34 &gt;= __pyx_pybuffernd_g2.diminfo[0].shape)) __pyx_t_33 = 0;
        if (__pyx_t_35 &lt; 0) {
          __pyx_t_35 += __pyx_pybuffernd_g2.diminfo[1].shape;
          if (unlikely(__pyx_t_35 &lt; 0)) __pyx_t_33 = 1;
        } else if (unlikely(__pyx_t_35 &gt;= __pyx_pybuffernd_g2.diminfo[1].shape)) __pyx_t_33 = 1;
        if (__pyx_t_36 &lt; 0) {
          __pyx_t_36 += __pyx_pybuffernd_g2.diminfo[2].shape;
          if (unlikely(__pyx_t_36 &lt; 0)) __pyx_t_33 = 2;
        } else if (unlikely(__pyx_t_36 &gt;= __pyx_pybuffernd_g2.diminfo[2].shape)) __pyx_t_33 = 2;
        if (unlikely(__pyx_t_33 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_33);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_33 = __pyx_v_ijk;
        __pyx_t_37 = -1;
        if (__pyx_t_33 &lt; 0) {
          __pyx_t_33 += __pyx_pybuffernd_grvval.diminfo[0].shape;
          if (unlikely(__pyx_t_33 &lt; 0)) __pyx_t_37 = 0;
        } else if (unlikely(__pyx_t_33 &gt;= __pyx_pybuffernd_grvval.diminfo[0].shape)) __pyx_t_37 = 0;
        if (unlikely(__pyx_t_37 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_37);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        *__Pyx_BufPtrStrided1d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_grvval.rcbuffer-&gt;pybuffer.buf, __pyx_t_33, __pyx_pybuffernd_grvval.diminfo[0].strides) += (*__Pyx_BufPtrStrided3d(__pyx_t_8packages_5pfmod_14grvmagc_27_x64_DTYPED_t *, __pyx_pybuffernd_g2.rcbuffer-&gt;pybuffer.buf, __pyx_t_34, __pyx_pybuffernd_g2.diminfo[0].strides, __pyx_t_35, __pyx_pybuffernd_g2.diminfo[1].strides, __pyx_t_36, __pyx_pybuffernd_g2.diminfo[2].strides));
      }
      __pyx_L5_continue:;
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line321")'> 321: </pre>
<pre id='line321' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line322")'> 322: </pre>
<pre id='line322' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF0b' onclick='toggleDiv("line323")'> 323: def gboxmain(np.ndarray[double, ndim=2] gval, np.ndarray[double, ndim=1] xobs,</pre>
<pre id='line323' class='code' style='background-color: #FFFF0b'>/* Python wrapper */
static PyObject *__pyx_pw_8packages_5pfmod_14grvmagc_27_x64_5gboxmain(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8packages_5pfmod_14grvmagc_27_x64_4gboxmain[] = " Gbox routine by Blakely\n        Note: xobs, yobs and zobs must be floats or there will be problems\n        later.\n\n    Subroutine GBOX computes the vertical attraction of a\n    rectangular prism.  Sides of prism are parallel to x,y,z axes,\n    and z axis is vertical down.\n\n    Input parameters:\n        Observation point is (x0,y0,z0).  The prism extends from x1\n        to x2, from y1 to y2, and from z1 to z2 in the x, y, and z\n        directions, respectively.  Density of prism is rho.  All\n        distance parameters in units of m;\n\n    Output parameters:\n        Vertical attraction of gravity, g, in mGal/rho.\n        Must still be multiplied by rho outside routine.\n        Done this way for speed. ";
static PyMethodDef __pyx_mdef_8packages_5pfmod_14grvmagc_27_x64_5gboxmain = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("gboxmain"), (PyCFunction)__pyx_pw_8packages_5pfmod_14grvmagc_27_x64_5gboxmain, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_8packages_5pfmod_14grvmagc_27_x64_4gboxmain)};
static PyObject *__pyx_pw_8packages_5pfmod_14grvmagc_27_x64_5gboxmain(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_gval = 0;
  PyArrayObject *__pyx_v_xobs = 0;
  PyArrayObject *__pyx_v_yobs = 0;
  int __pyx_v_numx;
  int __pyx_v_numy;
  double __pyx_v_z_0;
  double __pyx_v_x_1;
  double __pyx_v_y_1;
  double __pyx_v_z_1;
  double __pyx_v_x_2;
  double __pyx_v_y_2;
  double __pyx_v_z_2;
  CYTHON_UNUSED double __pyx_v_pi;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gboxmain (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_gval,&amp;__pyx_n_s_xobs,&amp;__pyx_n_s_yobs,&amp;__pyx_n_s_numx,&amp;__pyx_n_s_numy,&amp;__pyx_n_s_z_0,&amp;__pyx_n_s_x_1,&amp;__pyx_n_s_y_1,&amp;__pyx_n_s_z_1,&amp;__pyx_n_s_x_2,&amp;__pyx_n_s_y_2,&amp;__pyx_n_s_z_2,&amp;__pyx_n_s_pi,0};
    PyObject* values[13] = {0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_gval)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_xobs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gboxmain", 1, 13, 13, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_yobs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gboxmain", 1, 13, 13, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_numx)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gboxmain", 1, 13, 13, 3); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        if (likely((values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_numy)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gboxmain", 1, 13, 13, 4); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  5:
        if (likely((values[5] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_z_0)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gboxmain", 1, 13, 13, 5); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  6:
        if (likely((values[6] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_x_1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gboxmain", 1, 13, 13, 6); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  7:
        if (likely((values[7] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_y_1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gboxmain", 1, 13, 13, 7); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  8:
        if (likely((values[8] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_z_1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gboxmain", 1, 13, 13, 8); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  9:
        if (likely((values[9] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_x_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gboxmain", 1, 13, 13, 9); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 10:
        if (likely((values[10] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_y_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gboxmain", 1, 13, 13, 10); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 11:
        if (likely((values[11] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_z_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gboxmain", 1, 13, 13, 11); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 12:
        if (likely((values[12] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_pi)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gboxmain", 1, 13, 13, 12); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gboxmain") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 13) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
      values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
      values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
      values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
      values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
      values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
      values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
    }
    __pyx_v_gval = ((PyArrayObject *)values[0]);
    __pyx_v_xobs = ((PyArrayObject *)values[1]);
    __pyx_v_yobs = ((PyArrayObject *)values[2]);
    __pyx_v_numx = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[3]);<span class='error_goto'> if (unlikely((__pyx_v_numx == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_numy = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[4]);<span class='error_goto'> if (unlikely((__pyx_v_numy == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_z_0 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]);<span class='error_goto'> if (unlikely((__pyx_v_z_0 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_x_1 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]);<span class='error_goto'> if (unlikely((__pyx_v_x_1 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_y_1 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[7]);<span class='error_goto'> if (unlikely((__pyx_v_y_1 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_z_1 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]);<span class='error_goto'> if (unlikely((__pyx_v_z_1 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_x_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[9]);<span class='error_goto'> if (unlikely((__pyx_v_x_2 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_y_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[10]);<span class='error_goto'> if (unlikely((__pyx_v_y_2 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_z_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[11]);<span class='error_goto'> if (unlikely((__pyx_v_z_2 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_pi = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[12]);<span class='error_goto'> if (unlikely((__pyx_v_pi == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("gboxmain", 1, 13, 13, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("packages.pfmod.grvmagc_27_x64.gboxmain", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_gval), __pyx_ptype_5numpy_ndarray, 1, "gval", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_xobs), __pyx_ptype_5numpy_ndarray, 1, "xobs", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_yobs), __pyx_ptype_5numpy_ndarray, 1, "yobs", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_8packages_5pfmod_14grvmagc_27_x64_4gboxmain(__pyx_self, __pyx_v_gval, __pyx_v_xobs, __pyx_v_yobs, __pyx_v_numx, __pyx_v_numy, __pyx_v_z_0, __pyx_v_x_1, __pyx_v_y_1, __pyx_v_z_1, __pyx_v_x_2, __pyx_v_y_2, __pyx_v_z_2, __pyx_v_pi);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_8packages_5pfmod_14grvmagc_27_x64_4gboxmain(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_gval, PyArrayObject *__pyx_v_xobs, PyArrayObject *__pyx_v_yobs, int __pyx_v_numx, int __pyx_v_numy, double __pyx_v_z_0, double __pyx_v_x_1, double __pyx_v_y_1, double __pyx_v_z_1, double __pyx_v_x_2, double __pyx_v_y_2, double __pyx_v_z_2, CYTHON_UNUSED double __pyx_v_pi) {
  int __pyx_v_isign[2];
  double __pyx_v_x[2];
  double __pyx_v_y[2];
  double __pyx_v_z[2];
  double __pyx_v_rijk;
  int __pyx_v_ijk;
  double __pyx_v_arg1;
  double __pyx_v_arg2;
  double __pyx_v_arg3;
  double __pyx_v_sumi;
  int __pyx_v_ii;
  int __pyx_v_jj;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_gval;
  __Pyx_Buffer __pyx_pybuffer_gval;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_xobs;
  __Pyx_Buffer __pyx_pybuffer_xobs;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_yobs;
  __Pyx_Buffer __pyx_pybuffer_yobs;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("gboxmain", 0);
  __pyx_pybuffer_gval.pybuffer.buf = NULL;
  __pyx_pybuffer_gval.refcount = 0;
  __pyx_pybuffernd_gval.data = NULL;
  __pyx_pybuffernd_gval.rcbuffer = &amp;__pyx_pybuffer_gval;
  __pyx_pybuffer_xobs.pybuffer.buf = NULL;
  __pyx_pybuffer_xobs.refcount = 0;
  __pyx_pybuffernd_xobs.data = NULL;
  __pyx_pybuffernd_xobs.rcbuffer = &amp;__pyx_pybuffer_xobs;
  __pyx_pybuffer_yobs.pybuffer.buf = NULL;
  __pyx_pybuffer_yobs.refcount = 0;
  __pyx_pybuffernd_yobs.data = NULL;
  __pyx_pybuffernd_yobs.rcbuffer = &amp;__pyx_pybuffer_yobs;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_gval.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_gval, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_gval.diminfo[0].strides = __pyx_pybuffernd_gval.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_gval.diminfo[0].shape = __pyx_pybuffernd_gval.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_gval.diminfo[1].strides = __pyx_pybuffernd_gval.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_gval.diminfo[1].shape = __pyx_pybuffernd_gval.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_xobs.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_xobs, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_xobs.diminfo[0].strides = __pyx_pybuffernd_xobs.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_xobs.diminfo[0].shape = __pyx_pybuffernd_xobs.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_yobs.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_yobs, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_yobs.diminfo[0].strides = __pyx_pybuffernd_yobs.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_yobs.diminfo[0].shape = __pyx_pybuffernd_yobs.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_gval.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_xobs.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_yobs.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("packages.pfmod.grvmagc_27_x64.gboxmain", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_gval.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_xobs.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_yobs.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__14 = <span class='py_c_api'>PyTuple_Pack</span>(28, __pyx_n_s_gval, __pyx_n_s_xobs, __pyx_n_s_yobs, __pyx_n_s_numx, __pyx_n_s_numy, __pyx_n_s_z_0, __pyx_n_s_x_1, __pyx_n_s_y_1, __pyx_n_s_z_1, __pyx_n_s_x_2, __pyx_n_s_y_2, __pyx_n_s_z_2, __pyx_n_s_pi, __pyx_n_s_isign, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_rijk, __pyx_n_s_ijk, __pyx_n_s_arg1, __pyx_n_s_arg2, __pyx_n_s_arg3, __pyx_n_s_sumi, __pyx_n_s_ii, __pyx_n_s_jj, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k);<span class='error_goto'> if (unlikely(!__pyx_tuple__14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__14);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__14);
/* … */
  __pyx_t_2 = PyCFunction_NewEx(&amp;__pyx_mdef_8packages_5pfmod_14grvmagc_27_x64_5gboxmain, NULL, __pyx_n_s_packages_pfmod_grvmagc_27_x64);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_gboxmain, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_codeobj__15 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(13, 0, 28, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__14, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_C_Work_Programming_PyGMI2_packag, __pyx_n_s_gboxmain, 323, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line324")'> 324:              np.ndarray[double, ndim=1] yobs, int numx, int numy, double z_0,</pre>
<pre id='line324' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line325")'> 325:              double x_1, double y_1, double z_1, double x_2, double y_2,</pre>
<pre id='line325' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line326")'> 326:              double z_2, double pi):</pre>
<pre id='line326' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line327")'> 327:     """ Gbox routine by Blakely</pre>
<pre id='line327' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line328")'> 328:         Note: xobs, yobs and zobs must be floats or there will be problems</pre>
<pre id='line328' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line329")'> 329:         later.</pre>
<pre id='line329' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line330")'> 330: </pre>
<pre id='line330' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line331")'> 331:     Subroutine GBOX computes the vertical attraction of a</pre>
<pre id='line331' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line332")'> 332:     rectangular prism.  Sides of prism are parallel to x,y,z axes,</pre>
<pre id='line332' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line333")'> 333:     and z axis is vertical down.</pre>
<pre id='line333' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line334")'> 334: </pre>
<pre id='line334' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line335")'> 335:     Input parameters:</pre>
<pre id='line335' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line336")'> 336:         Observation point is (x0,y0,z0).  The prism extends from x1</pre>
<pre id='line336' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line337")'> 337:         to x2, from y1 to y2, and from z1 to z2 in the x, y, and z</pre>
<pre id='line337' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line338")'> 338:         directions, respectively.  Density of prism is rho.  All</pre>
<pre id='line338' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line339")'> 339:         distance parameters in units of m;</pre>
<pre id='line339' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line340")'> 340: </pre>
<pre id='line340' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line341")'> 341:     Output parameters:</pre>
<pre id='line341' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line342")'> 342:         Vertical attraction of gravity, g, in mGal/rho.</pre>
<pre id='line342' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line343")'> 343:         Must still be multiplied by rho outside routine.</pre>
<pre id='line343' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line344")'> 344:         Done this way for speed. """</pre>
<pre id='line344' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line345")'> 345: </pre>
<pre id='line345' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line346")'> 346:     # include &lt;math.h&gt;</pre>
<pre id='line346' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line347")'> 347:     cdef int isign[2]</pre>
<pre id='line347' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line348")'> 348:     cdef double x[2]</pre>
<pre id='line348' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line349")'> 349:     cdef double y[2]</pre>
<pre id='line349' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line350")'> 350:     cdef double z[2]</pre>
<pre id='line350' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line351")'> 351:     cdef double rijk</pre>
<pre id='line351' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line352")'> 352:     cdef int ijk</pre>
<pre id='line352' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line353")'> 353:     cdef double arg1</pre>
<pre id='line353' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line354")'> 354:     cdef double arg2</pre>
<pre id='line354' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line355")'> 355:     cdef double arg3</pre>
<pre id='line355' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line356")'> 356:     cdef double sumi</pre>
<pre id='line356' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line357")'> 357:     cdef int ii</pre>
<pre id='line357' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line358")'> 358:     cdef int jj</pre>
<pre id='line358' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line359")'> 359:     cdef int i</pre>
<pre id='line359' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line360")'> 360:     cdef int j</pre>
<pre id='line360' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line361")'> 361:     cdef int k</pre>
<pre id='line361' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line362")'> 362: </pre>
<pre id='line362' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line363")'> 363:     isign[0] = -1</pre>
<pre id='line363' class='code' style='background-color: #FFFFff'>  (__pyx_v_isign[0]) = -1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line364")'> 364:     isign[1] = 1</pre>
<pre id='line364' class='code' style='background-color: #FFFFff'>  (__pyx_v_isign[1]) = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line365")'> 365:     z[0] = z_0-z_1</pre>
<pre id='line365' class='code' style='background-color: #FFFFff'>  (__pyx_v_z[0]) = (__pyx_v_z_0 - __pyx_v_z_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line366")'> 366:     z[1] = z_0-z_2</pre>
<pre id='line366' class='code' style='background-color: #FFFFff'>  (__pyx_v_z[1]) = (__pyx_v_z_0 - __pyx_v_z_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line367")'> 367: </pre>
<pre id='line367' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line368")'> 368:     for ii in range(numx):</pre>
<pre id='line368' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_numx;
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_ii = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line369")'> 369:         x[0] = xobs[ii]-x_1</pre>
<pre id='line369' class='code' style='background-color: #FFFFd4'>    __pyx_t_3 = __pyx_v_ii;
    __pyx_t_4 = -1;
    if (__pyx_t_3 &lt; 0) {
      __pyx_t_3 += __pyx_pybuffernd_xobs.diminfo[0].shape;
      if (unlikely(__pyx_t_3 &lt; 0)) __pyx_t_4 = 0;
    } else if (unlikely(__pyx_t_3 &gt;= __pyx_pybuffernd_xobs.diminfo[0].shape)) __pyx_t_4 = 0;
    if (unlikely(__pyx_t_4 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    (__pyx_v_x[0]) = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_xobs.rcbuffer-&gt;pybuffer.buf, __pyx_t_3, __pyx_pybuffernd_xobs.diminfo[0].strides)) - __pyx_v_x_1);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line370")'> 370:         x[1] = xobs[ii]-x_2</pre>
<pre id='line370' class='code' style='background-color: #FFFFd4'>    __pyx_t_4 = __pyx_v_ii;
    __pyx_t_5 = -1;
    if (__pyx_t_4 &lt; 0) {
      __pyx_t_4 += __pyx_pybuffernd_xobs.diminfo[0].shape;
      if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_5 = 0;
    } else if (unlikely(__pyx_t_4 &gt;= __pyx_pybuffernd_xobs.diminfo[0].shape)) __pyx_t_5 = 0;
    if (unlikely(__pyx_t_5 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_5);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 370; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    (__pyx_v_x[1]) = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_xobs.rcbuffer-&gt;pybuffer.buf, __pyx_t_4, __pyx_pybuffernd_xobs.diminfo[0].strides)) - __pyx_v_x_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line371")'> 371:         for jj in range(numy):</pre>
<pre id='line371' class='code' style='background-color: #FFFFff'>    __pyx_t_5 = __pyx_v_numy;
    for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_jj = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line372")'> 372:             y[0] = yobs[jj]-y_1</pre>
<pre id='line372' class='code' style='background-color: #FFFFd4'>      __pyx_t_7 = __pyx_v_jj;
      __pyx_t_8 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_pybuffernd_yobs.diminfo[0].shape;
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_pybuffernd_yobs.diminfo[0].shape)) __pyx_t_8 = 0;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      (__pyx_v_y[0]) = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_yobs.rcbuffer-&gt;pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_yobs.diminfo[0].strides)) - __pyx_v_y_1);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line373")'> 373:             y[1] = yobs[jj]-y_2</pre>
<pre id='line373' class='code' style='background-color: #FFFFd4'>      __pyx_t_8 = __pyx_v_jj;
      __pyx_t_9 = -1;
      if (__pyx_t_8 &lt; 0) {
        __pyx_t_8 += __pyx_pybuffernd_yobs.diminfo[0].shape;
        if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_9 = 0;
      } else if (unlikely(__pyx_t_8 &gt;= __pyx_pybuffernd_yobs.diminfo[0].shape)) __pyx_t_9 = 0;
      if (unlikely(__pyx_t_9 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_9);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      (__pyx_v_y[1]) = ((*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_yobs.rcbuffer-&gt;pybuffer.buf, __pyx_t_8, __pyx_pybuffernd_yobs.diminfo[0].strides)) - __pyx_v_y_2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line374")'> 374:             sumi = 0.</pre>
<pre id='line374' class='code' style='background-color: #FFFFff'>      __pyx_v_sumi = 0.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line375")'> 375:             for i in range(2):</pre>
<pre id='line375' class='code' style='background-color: #FFFFff'>      for (__pyx_t_9 = 0; __pyx_t_9 &lt; 2; __pyx_t_9+=1) {
        __pyx_v_i = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line376")'> 376:                 for j in range(2):</pre>
<pre id='line376' class='code' style='background-color: #FFFFff'>        for (__pyx_t_10 = 0; __pyx_t_10 &lt; 2; __pyx_t_10+=1) {
          __pyx_v_j = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line377")'> 377:                     for k in range(2):</pre>
<pre id='line377' class='code' style='background-color: #FFFFff'>          for (__pyx_t_11 = 0; __pyx_t_11 &lt; 2; __pyx_t_11+=1) {
            __pyx_v_k = __pyx_t_11;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line378")'> 378:                         rijk = sqrt(x[i]*x[i]+y[j]*y[j]+z[k]*z[k])</pre>
<pre id='line378' class='code' style='background-color: #FFFFff'>            __pyx_v_rijk = sqrt(((((__pyx_v_x[__pyx_v_i]) * (__pyx_v_x[__pyx_v_i])) + ((__pyx_v_y[__pyx_v_j]) * (__pyx_v_y[__pyx_v_j]))) + ((__pyx_v_z[__pyx_v_k]) * (__pyx_v_z[__pyx_v_k]))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line379")'> 379:                         ijk = isign[i]*isign[j]*isign[k]</pre>
<pre id='line379' class='code' style='background-color: #FFFFff'>            __pyx_v_ijk = (((__pyx_v_isign[__pyx_v_i]) * (__pyx_v_isign[__pyx_v_j])) * (__pyx_v_isign[__pyx_v_k]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line380")'> 380:                         arg1 = atan2(x[i]*y[j], z[k]*rijk)</pre>
<pre id='line380' class='code' style='background-color: #FFFFff'>            __pyx_v_arg1 = atan2(((__pyx_v_x[__pyx_v_i]) * (__pyx_v_y[__pyx_v_j])), ((__pyx_v_z[__pyx_v_k]) * __pyx_v_rijk));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line381")'> 381: </pre>
<pre id='line381' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line382")'> 382:                         if (arg1 &lt; 0.):</pre>
<pre id='line382' class='code' style='background-color: #FFFFff'>            __pyx_t_12 = ((__pyx_v_arg1 &lt; 0.) != 0);
            if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line383")'> 383:                             arg1 = arg1 + 2 * pi</pre>
<pre id='line383' class='code' style='background-color: #FFFFff'>              __pyx_v_arg1 = (__pyx_v_arg1 + (2.0 * 3.141592653589793));
              goto __pyx_L13;
            }
            __pyx_L13:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line384")'> 384:                         arg2 = rijk+y[j]</pre>
<pre id='line384' class='code' style='background-color: #FFFFff'>            __pyx_v_arg2 = (__pyx_v_rijk + (__pyx_v_y[__pyx_v_j]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line385")'> 385:                         arg3 = rijk+x[i]</pre>
<pre id='line385' class='code' style='background-color: #FFFFff'>            __pyx_v_arg3 = (__pyx_v_rijk + (__pyx_v_x[__pyx_v_i]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line386")'> 386:                         arg2 = log(arg2)</pre>
<pre id='line386' class='code' style='background-color: #FFFFff'>            __pyx_v_arg2 = log(__pyx_v_arg2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line387")'> 387:                         arg3 = log(arg3)</pre>
<pre id='line387' class='code' style='background-color: #FFFFff'>            __pyx_v_arg3 = log(__pyx_v_arg3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line388")'> 388:                         sumi += ijk*(z[k]*arg1-x[i]*arg2-y[j]*arg3)</pre>
<pre id='line388' class='code' style='background-color: #FFFFff'>            __pyx_v_sumi = (__pyx_v_sumi + (__pyx_v_ijk * ((((__pyx_v_z[__pyx_v_k]) * __pyx_v_arg1) - ((__pyx_v_x[__pyx_v_i]) * __pyx_v_arg2)) - ((__pyx_v_y[__pyx_v_j]) * __pyx_v_arg3))));
          }
        }
      }
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line389")'> 389:             gval[ii, jj] = sumi</pre>
<pre id='line389' class='code' style='background-color: #FFFFd4'>      __pyx_t_9 = __pyx_v_ii;
      __pyx_t_10 = __pyx_v_jj;
      __pyx_t_11 = -1;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_pybuffernd_gval.diminfo[0].shape;
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_11 = 0;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_pybuffernd_gval.diminfo[0].shape)) __pyx_t_11 = 0;
      if (__pyx_t_10 &lt; 0) {
        __pyx_t_10 += __pyx_pybuffernd_gval.diminfo[1].shape;
        if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_11 = 1;
      } else if (unlikely(__pyx_t_10 &gt;= __pyx_pybuffernd_gval.diminfo[1].shape)) __pyx_t_11 = 1;
      if (unlikely(__pyx_t_11 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_11);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_gval.rcbuffer-&gt;pybuffer.buf, __pyx_t_9, __pyx_pybuffernd_gval.diminfo[0].strides, __pyx_t_10, __pyx_pybuffernd_gval.diminfo[1].strides) = __pyx_v_sumi;
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line390")'> 390: </pre>
<pre id='line390' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line391")'> 391: </pre>
<pre id='line391' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF08' onclick='toggleDiv("line392")'> 392: def mboxmain(int icnt, np.ndarray[double, ndim=1] z1mz0,</pre>
<pre id='line392' class='code' style='background-color: #FFFF08'>/* Python wrapper */
static PyObject *__pyx_pw_8packages_5pfmod_14grvmagc_27_x64_7mboxmain(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8packages_5pfmod_14grvmagc_27_x64_6mboxmain[] = "Subroutine MBOX computes the total field anomaly of an infinitely\n  extended rectangular prism.  Sides of prism are parallel to x,y,z\n  axes, and z is vertical down.  Bottom of prism extends to infinity.\n  Two calls to mbox can provide the anomaly of a prism with finite\n  thickness; e.g.,\n\n     call mbox(x0,y0,z0,x1,y1,z1,x2,y2,mi,md,fi,fd,m,theta,t1)\n     call mbox(x0,y0,z0,x1,y1,z2,x2,y2,mi,md,fi,fd,m,theta,t2)\n     t=t1-t2\n\n  Requires subroutine DIRCOS.  Method from Bhattacharyya (1964).\n\n  Input parameters:\n    Observation point is (x0,y0,z0).  Prism extends from x1 to\n    x2, y1 to y2, and z1 to infinity in x, y, and z directions,\n    respectively.  Magnetization defined by inclination mi,\n    declination md, intensity m.  Ambient field defined by\n    inclination fi and declination fd.  X axis has declination\n    theta. Distance units are irrelevant but must be consistent.\n    Angles are in degrees, with inclinations positive below\n    horizontal and declinations positive east of true north.\n    Magnetization in A/m.\n\n    Note that in the case of no remanence: mi=fi and md=fd.\n\n  Output paramters:\n    Total field anomaly t, in nT. ";
static PyMethodDef __pyx_mdef_8packages_5pfmod_14grvmagc_27_x64_7mboxmain = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("mboxmain"), (PyCFunction)__pyx_pw_8packages_5pfmod_14grvmagc_27_x64_7mboxmain, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_8packages_5pfmod_14grvmagc_27_x64_6mboxmain)};
static PyObject *__pyx_pw_8packages_5pfmod_14grvmagc_27_x64_7mboxmain(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_icnt;
  PyArrayObject *__pyx_v_z1mz0 = 0;
  PyArrayObject *__pyx_v_mval = 0;
  PyArrayObject *__pyx_v_xobs = 0;
  PyArrayObject *__pyx_v_yobs = 0;
  CYTHON_UNUSED int __pyx_v_numx;
  int __pyx_v_numy;
  int __pyx_v_numz;
  double __pyx_v_x_1;
  double __pyx_v_y_1;
  double __pyx_v_x_2;
  double __pyx_v_y_2;
  double __pyx_v_fm1;
  double __pyx_v_fm2;
  double __pyx_v_fm3;
  double __pyx_v_fm4;
  double __pyx_v_fm5;
  double __pyx_v_fm6;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mboxmain (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_icnt,&amp;__pyx_n_s_z1mz0,&amp;__pyx_n_s_mval,&amp;__pyx_n_s_xobs,&amp;__pyx_n_s_yobs,&amp;__pyx_n_s_numx,&amp;__pyx_n_s_numy,&amp;__pyx_n_s_numz,&amp;__pyx_n_s_x_1,&amp;__pyx_n_s_y_1,&amp;__pyx_n_s_x_2,&amp;__pyx_n_s_y_2,&amp;__pyx_n_s_fm1,&amp;__pyx_n_s_fm2,&amp;__pyx_n_s_fm3,&amp;__pyx_n_s_fm4,&amp;__pyx_n_s_fm5,&amp;__pyx_n_s_fm6,0};
    PyObject* values[18] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_icnt)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_z1mz0)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_mval)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_xobs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 3); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        if (likely((values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_yobs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 4); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  5:
        if (likely((values[5] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_numx)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 5); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  6:
        if (likely((values[6] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_numy)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 6); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  7:
        if (likely((values[7] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_numz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 7); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  8:
        if (likely((values[8] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_x_1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 8); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  9:
        if (likely((values[9] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_y_1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 9); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 10:
        if (likely((values[10] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_x_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 10); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 11:
        if (likely((values[11] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_y_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 11); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 12:
        if (likely((values[12] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_fm1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 12); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 13:
        if (likely((values[13] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_fm2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 13); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 14:
        if (likely((values[14] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_fm3)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 14); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 15:
        if (likely((values[15] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_fm4)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 15); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 16:
        if (likely((values[16] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_fm5)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 16); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case 17:
        if (likely((values[17] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_fm6)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, 17); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "mboxmain") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 18) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
      values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
      values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
      values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
      values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
      values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
      values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
      values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
      values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
      values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
      values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
      values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
    }
    __pyx_v_icnt = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_icnt == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_z1mz0 = ((PyArrayObject *)values[1]);
    __pyx_v_mval = ((PyArrayObject *)values[2]);
    __pyx_v_xobs = ((PyArrayObject *)values[3]);
    __pyx_v_yobs = ((PyArrayObject *)values[4]);
    __pyx_v_numx = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[5]);<span class='error_goto'> if (unlikely((__pyx_v_numx == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 394; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_numy = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[6]);<span class='error_goto'> if (unlikely((__pyx_v_numy == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 394; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_numz = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[7]);<span class='error_goto'> if (unlikely((__pyx_v_numz == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 394; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_x_1 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]);<span class='error_goto'> if (unlikely((__pyx_v_x_1 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_y_1 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[9]);<span class='error_goto'> if (unlikely((__pyx_v_y_1 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_x_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[10]);<span class='error_goto'> if (unlikely((__pyx_v_x_2 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_y_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[11]);<span class='error_goto'> if (unlikely((__pyx_v_y_2 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_fm1 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[12]);<span class='error_goto'> if (unlikely((__pyx_v_fm1 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_fm2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[13]);<span class='error_goto'> if (unlikely((__pyx_v_fm2 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_fm3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[14]);<span class='error_goto'> if (unlikely((__pyx_v_fm3 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_fm4 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[15]);<span class='error_goto'> if (unlikely((__pyx_v_fm4 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_fm5 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[16]);<span class='error_goto'> if (unlikely((__pyx_v_fm5 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_fm6 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[17]);<span class='error_goto'> if (unlikely((__pyx_v_fm6 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mboxmain", 1, 18, 18, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("packages.pfmod.grvmagc_27_x64.mboxmain", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_z1mz0), __pyx_ptype_5numpy_ndarray, 1, "z1mz0", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_mval), __pyx_ptype_5numpy_ndarray, 1, "mval", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 393; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_xobs), __pyx_ptype_5numpy_ndarray, 1, "xobs", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 393; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_yobs), __pyx_ptype_5numpy_ndarray, 1, "yobs", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 394; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_8packages_5pfmod_14grvmagc_27_x64_6mboxmain(__pyx_self, __pyx_v_icnt, __pyx_v_z1mz0, __pyx_v_mval, __pyx_v_xobs, __pyx_v_yobs, __pyx_v_numx, __pyx_v_numy, __pyx_v_numz, __pyx_v_x_1, __pyx_v_y_1, __pyx_v_x_2, __pyx_v_y_2, __pyx_v_fm1, __pyx_v_fm2, __pyx_v_fm3, __pyx_v_fm4, __pyx_v_fm5, __pyx_v_fm6);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_8packages_5pfmod_14grvmagc_27_x64_6mboxmain(CYTHON_UNUSED PyObject *__pyx_self, int __pyx_v_icnt, PyArrayObject *__pyx_v_z1mz0, PyArrayObject *__pyx_v_mval, PyArrayObject *__pyx_v_xobs, PyArrayObject *__pyx_v_yobs, CYTHON_UNUSED int __pyx_v_numx, int __pyx_v_numy, int __pyx_v_numz, double __pyx_v_x_1, double __pyx_v_y_1, double __pyx_v_x_2, double __pyx_v_y_2, double __pyx_v_fm1, double __pyx_v_fm2, double __pyx_v_fm3, double __pyx_v_fm4, double __pyx_v_fm5, double __pyx_v_fm6) {
  double __pyx_v_alpha[2];
  double __pyx_v_beta[2];
  double __pyx_v_h;
  double __pyx_v_t;
  double __pyx_v_hsq;
  double __pyx_v_alphasq;
  double __pyx_v_r0sq;
  double __pyx_v_r0;
  double __pyx_v_r0h;
  double __pyx_v_alphabeta;
  double __pyx_v_arg1;
  double __pyx_v_arg2;
  double __pyx_v_arg3;
  double __pyx_v_arg4;
  double __pyx_v_tatan;
  double __pyx_v_sign;
  double __pyx_v_tlog;
  int __pyx_v_jj;
  int __pyx_v_kk;
  int __pyx_v_i;
  int __pyx_v_j;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_mval;
  __Pyx_Buffer __pyx_pybuffer_mval;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_xobs;
  __Pyx_Buffer __pyx_pybuffer_xobs;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_yobs;
  __Pyx_Buffer __pyx_pybuffer_yobs;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z1mz0;
  __Pyx_Buffer __pyx_pybuffer_z1mz0;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mboxmain", 0);
  __pyx_pybuffer_z1mz0.pybuffer.buf = NULL;
  __pyx_pybuffer_z1mz0.refcount = 0;
  __pyx_pybuffernd_z1mz0.data = NULL;
  __pyx_pybuffernd_z1mz0.rcbuffer = &amp;__pyx_pybuffer_z1mz0;
  __pyx_pybuffer_mval.pybuffer.buf = NULL;
  __pyx_pybuffer_mval.refcount = 0;
  __pyx_pybuffernd_mval.data = NULL;
  __pyx_pybuffernd_mval.rcbuffer = &amp;__pyx_pybuffer_mval;
  __pyx_pybuffer_xobs.pybuffer.buf = NULL;
  __pyx_pybuffer_xobs.refcount = 0;
  __pyx_pybuffernd_xobs.data = NULL;
  __pyx_pybuffernd_xobs.rcbuffer = &amp;__pyx_pybuffer_xobs;
  __pyx_pybuffer_yobs.pybuffer.buf = NULL;
  __pyx_pybuffer_yobs.refcount = 0;
  __pyx_pybuffernd_yobs.data = NULL;
  __pyx_pybuffernd_yobs.rcbuffer = &amp;__pyx_pybuffer_yobs;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_z1mz0.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_z1mz0, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_z1mz0.diminfo[0].strides = __pyx_pybuffernd_z1mz0.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_z1mz0.diminfo[0].shape = __pyx_pybuffernd_z1mz0.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mval.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_mval, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_mval.diminfo[0].strides = __pyx_pybuffernd_mval.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_mval.diminfo[0].shape = __pyx_pybuffernd_mval.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_mval.diminfo[1].strides = __pyx_pybuffernd_mval.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_mval.diminfo[1].shape = __pyx_pybuffernd_mval.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_mval.diminfo[2].strides = __pyx_pybuffernd_mval.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_mval.diminfo[2].shape = __pyx_pybuffernd_mval.rcbuffer-&gt;pybuffer.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_xobs.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_xobs, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_xobs.diminfo[0].strides = __pyx_pybuffernd_xobs.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_xobs.diminfo[0].shape = __pyx_pybuffernd_xobs.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_yobs.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_yobs, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_yobs.diminfo[0].strides = __pyx_pybuffernd_yobs.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_yobs.diminfo[0].shape = __pyx_pybuffernd_yobs.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mval.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_xobs.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_yobs.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_z1mz0.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("packages.pfmod.grvmagc_27_x64.mboxmain", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mval.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_xobs.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_yobs.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_z1mz0.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__16 = <span class='py_c_api'>PyTuple_Pack</span>(39, __pyx_n_s_icnt, __pyx_n_s_z1mz0, __pyx_n_s_mval, __pyx_n_s_xobs, __pyx_n_s_yobs, __pyx_n_s_numx, __pyx_n_s_numy, __pyx_n_s_numz, __pyx_n_s_x_1, __pyx_n_s_y_1, __pyx_n_s_x_2, __pyx_n_s_y_2, __pyx_n_s_fm1, __pyx_n_s_fm2, __pyx_n_s_fm3, __pyx_n_s_fm4, __pyx_n_s_fm5, __pyx_n_s_fm6, __pyx_n_s_alpha, __pyx_n_s_beta, __pyx_n_s_h, __pyx_n_s_t, __pyx_n_s_hsq, __pyx_n_s_alphasq, __pyx_n_s_r0sq, __pyx_n_s_r0, __pyx_n_s_r0h, __pyx_n_s_alphabeta, __pyx_n_s_arg1, __pyx_n_s_arg2, __pyx_n_s_arg3, __pyx_n_s_arg4, __pyx_n_s_tatan, __pyx_n_s_sign, __pyx_n_s_tlog, __pyx_n_s_jj, __pyx_n_s_kk, __pyx_n_s_i, __pyx_n_s_j);<span class='error_goto'> if (unlikely(!__pyx_tuple__16)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__16);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__16);
/* … */
  __pyx_t_2 = PyCFunction_NewEx(&amp;__pyx_mdef_8packages_5pfmod_14grvmagc_27_x64_7mboxmain, NULL, __pyx_n_s_packages_pfmod_grvmagc_27_x64);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_mboxmain, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line393")'> 393:              np.ndarray[double, ndim=3] mval, np.ndarray[double, ndim=1] xobs,</pre>
<pre id='line393' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line394")'> 394:              np.ndarray[double, ndim=1] yobs, int numx, int numy, int numz,</pre>
<pre id='line394' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line395")'> 395:              double x_1, double y_1, double x_2, double y_2, double fm1,</pre>
<pre id='line395' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line396")'> 396:              double fm2, double fm3, double fm4, double fm5, double fm6):</pre>
<pre id='line396' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line397")'> 397: </pre>
<pre id='line397' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line398")'> 398:     """Subroutine MBOX computes the total field anomaly of an infinitely</pre>
<pre id='line398' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line399")'> 399:   extended rectangular prism.  Sides of prism are parallel to x,y,z</pre>
<pre id='line399' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line400")'> 400:   axes, and z is vertical down.  Bottom of prism extends to infinity.</pre>
<pre id='line400' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line401")'> 401:   Two calls to mbox can provide the anomaly of a prism with finite</pre>
<pre id='line401' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line402")'> 402:   thickness; e.g.,</pre>
<pre id='line402' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line403")'> 403: </pre>
<pre id='line403' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line404")'> 404:      call mbox(x0,y0,z0,x1,y1,z1,x2,y2,mi,md,fi,fd,m,theta,t1)</pre>
<pre id='line404' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line405")'> 405:      call mbox(x0,y0,z0,x1,y1,z2,x2,y2,mi,md,fi,fd,m,theta,t2)</pre>
<pre id='line405' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line406")'> 406:      t=t1-t2</pre>
<pre id='line406' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line407")'> 407: </pre>
<pre id='line407' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line408")'> 408:   Requires subroutine DIRCOS.  Method from Bhattacharyya (1964).</pre>
<pre id='line408' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line409")'> 409: </pre>
<pre id='line409' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line410")'> 410:   Input parameters:</pre>
<pre id='line410' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line411")'> 411:     Observation point is (x0,y0,z0).  Prism extends from x1 to</pre>
<pre id='line411' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line412")'> 412:     x2, y1 to y2, and z1 to infinity in x, y, and z directions,</pre>
<pre id='line412' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line413")'> 413:     respectively.  Magnetization defined by inclination mi,</pre>
<pre id='line413' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line414")'> 414:     declination md, intensity m.  Ambient field defined by</pre>
<pre id='line414' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line415")'> 415:     inclination fi and declination fd.  X axis has declination</pre>
<pre id='line415' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line416")'> 416:     theta. Distance units are irrelevant but must be consistent.</pre>
<pre id='line416' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line417")'> 417:     Angles are in degrees, with inclinations positive below</pre>
<pre id='line417' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line418")'> 418:     horizontal and declinations positive east of true north.</pre>
<pre id='line418' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line419")'> 419:     Magnetization in A/m.</pre>
<pre id='line419' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line420")'> 420: </pre>
<pre id='line420' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line421")'> 421:     Note that in the case of no remanence: mi=fi and md=fd.</pre>
<pre id='line421' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line422")'> 422: </pre>
<pre id='line422' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line423")'> 423:   Output paramters:</pre>
<pre id='line423' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line424")'> 424:     Total field anomaly t, in nT. """</pre>
<pre id='line424' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line425")'> 425: </pre>
<pre id='line425' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line426")'> 426:     # include &lt;math.h&gt;</pre>
<pre id='line426' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line427")'> 427:     cdef double alpha[2]</pre>
<pre id='line427' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line428")'> 428:     cdef double beta[2]</pre>
<pre id='line428' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line429")'> 429:     cdef double h</pre>
<pre id='line429' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line430")'> 430:     cdef double t</pre>
<pre id='line430' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line431")'> 431:     cdef double hsq</pre>
<pre id='line431' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line432")'> 432:     cdef double alphasq</pre>
<pre id='line432' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line433")'> 433:     cdef double r0sq</pre>
<pre id='line433' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line434")'> 434:     cdef double r0</pre>
<pre id='line434' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line435")'> 435:     cdef double r0h</pre>
<pre id='line435' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line436")'> 436:     cdef double alphabeta</pre>
<pre id='line436' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line437")'> 437:     cdef double arg1</pre>
<pre id='line437' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line438")'> 438:     cdef double arg2</pre>
<pre id='line438' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line439")'> 439:     cdef double arg3</pre>
<pre id='line439' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line440")'> 440:     cdef double arg4</pre>
<pre id='line440' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line441")'> 441:     cdef double tatan</pre>
<pre id='line441' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line442")'> 442:     cdef double sign</pre>
<pre id='line442' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line443")'> 443:     cdef double tlog</pre>
<pre id='line443' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line444")'> 444:     cdef int jj</pre>
<pre id='line444' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line445")'> 445:     cdef int kk</pre>
<pre id='line445' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line446")'> 446:     cdef int i</pre>
<pre id='line446' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line447")'> 447:     cdef int j</pre>
<pre id='line447' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line448")'> 448: </pre>
<pre id='line448' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line449")'> 449:     alpha[0] = x_1-xobs[icnt]</pre>
<pre id='line449' class='code' style='background-color: #FFFFd4'>  __pyx_t_1 = __pyx_v_icnt;
  __pyx_t_2 = -1;
  if (__pyx_t_1 &lt; 0) {
    __pyx_t_1 += __pyx_pybuffernd_xobs.diminfo[0].shape;
    if (unlikely(__pyx_t_1 &lt; 0)) __pyx_t_2 = 0;
  } else if (unlikely(__pyx_t_1 &gt;= __pyx_pybuffernd_xobs.diminfo[0].shape)) __pyx_t_2 = 0;
  if (unlikely(__pyx_t_2 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_2);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  (__pyx_v_alpha[0]) = (__pyx_v_x_1 - (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_xobs.rcbuffer-&gt;pybuffer.buf, __pyx_t_1, __pyx_pybuffernd_xobs.diminfo[0].strides)));
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line450")'> 450:     alpha[1] = x_2-xobs[icnt]</pre>
<pre id='line450' class='code' style='background-color: #FFFFd4'>  __pyx_t_2 = __pyx_v_icnt;
  __pyx_t_3 = -1;
  if (__pyx_t_2 &lt; 0) {
    __pyx_t_2 += __pyx_pybuffernd_xobs.diminfo[0].shape;
    if (unlikely(__pyx_t_2 &lt; 0)) __pyx_t_3 = 0;
  } else if (unlikely(__pyx_t_2 &gt;= __pyx_pybuffernd_xobs.diminfo[0].shape)) __pyx_t_3 = 0;
  if (unlikely(__pyx_t_3 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  (__pyx_v_alpha[1]) = (__pyx_v_x_2 - (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_xobs.rcbuffer-&gt;pybuffer.buf, __pyx_t_2, __pyx_pybuffernd_xobs.diminfo[0].strides)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line451")'> 451:     for jj in range(numy):</pre>
<pre id='line451' class='code' style='background-color: #FFFFff'>  __pyx_t_3 = __pyx_v_numy;
  for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
    __pyx_v_jj = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line452")'> 452:         beta[0] = y_1-yobs[jj]</pre>
<pre id='line452' class='code' style='background-color: #FFFFd4'>    __pyx_t_5 = __pyx_v_jj;
    __pyx_t_6 = -1;
    if (__pyx_t_5 &lt; 0) {
      __pyx_t_5 += __pyx_pybuffernd_yobs.diminfo[0].shape;
      if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_6 = 0;
    } else if (unlikely(__pyx_t_5 &gt;= __pyx_pybuffernd_yobs.diminfo[0].shape)) __pyx_t_6 = 0;
    if (unlikely(__pyx_t_6 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    (__pyx_v_beta[0]) = (__pyx_v_y_1 - (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_yobs.rcbuffer-&gt;pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_yobs.diminfo[0].strides)));
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line453")'> 453:         beta[1] = y_2-yobs[jj]</pre>
<pre id='line453' class='code' style='background-color: #FFFFd4'>    __pyx_t_6 = __pyx_v_jj;
    __pyx_t_7 = -1;
    if (__pyx_t_6 &lt; 0) {
      __pyx_t_6 += __pyx_pybuffernd_yobs.diminfo[0].shape;
      if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_7 = 0;
    } else if (unlikely(__pyx_t_6 &gt;= __pyx_pybuffernd_yobs.diminfo[0].shape)) __pyx_t_7 = 0;
    if (unlikely(__pyx_t_7 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_7);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 453; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    (__pyx_v_beta[1]) = (__pyx_v_y_2 - (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_yobs.rcbuffer-&gt;pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_yobs.diminfo[0].strides)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line454")'> 454:         for kk in range(numz):</pre>
<pre id='line454' class='code' style='background-color: #FFFFff'>    __pyx_t_7 = __pyx_v_numz;
    for (__pyx_t_8 = 0; __pyx_t_8 &lt; __pyx_t_7; __pyx_t_8+=1) {
      __pyx_v_kk = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line455")'> 455:             h = z1mz0[kk]</pre>
<pre id='line455' class='code' style='background-color: #FFFFd4'>      __pyx_t_9 = __pyx_v_kk;
      __pyx_t_10 = -1;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_pybuffernd_z1mz0.diminfo[0].shape;
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_10 = 0;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_pybuffernd_z1mz0.diminfo[0].shape)) __pyx_t_10 = 0;
      if (unlikely(__pyx_t_10 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_10);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 455; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_v_h = (*__Pyx_BufPtrStrided1d(double *, __pyx_pybuffernd_z1mz0.rcbuffer-&gt;pybuffer.buf, __pyx_t_9, __pyx_pybuffernd_z1mz0.diminfo[0].strides));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line456")'> 456:             hsq = h*h</pre>
<pre id='line456' class='code' style='background-color: #FFFFff'>      __pyx_v_hsq = (__pyx_v_h * __pyx_v_h);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line457")'> 457:             t = 0.</pre>
<pre id='line457' class='code' style='background-color: #FFFFff'>      __pyx_v_t = 0.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line458")'> 458:             for i in range(2):</pre>
<pre id='line458' class='code' style='background-color: #FFFFff'>      for (__pyx_t_10 = 0; __pyx_t_10 &lt; 2; __pyx_t_10+=1) {
        __pyx_v_i = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line459")'> 459:                 alphasq = alpha[i]*alpha[i]</pre>
<pre id='line459' class='code' style='background-color: #FFFFff'>        __pyx_v_alphasq = ((__pyx_v_alpha[__pyx_v_i]) * (__pyx_v_alpha[__pyx_v_i]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line460")'> 460:                 for j in range(2):</pre>
<pre id='line460' class='code' style='background-color: #FFFFff'>        for (__pyx_t_11 = 0; __pyx_t_11 &lt; 2; __pyx_t_11+=1) {
          __pyx_v_j = __pyx_t_11;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line461")'> 461:                     sign = 1.</pre>
<pre id='line461' class='code' style='background-color: #FFFFff'>          __pyx_v_sign = 1.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line462")'> 462:                     if (i != j):</pre>
<pre id='line462' class='code' style='background-color: #FFFFff'>          __pyx_t_12 = ((__pyx_v_i != __pyx_v_j) != 0);
          if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line463")'> 463:                         sign = -1.</pre>
<pre id='line463' class='code' style='background-color: #FFFFff'>            __pyx_v_sign = -1.;
            goto __pyx_L11;
          }
          __pyx_L11:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line464")'> 464:                     r0sq = alphasq+beta[j]*beta[j]+hsq</pre>
<pre id='line464' class='code' style='background-color: #FFFFff'>          __pyx_v_r0sq = ((__pyx_v_alphasq + ((__pyx_v_beta[__pyx_v_j]) * (__pyx_v_beta[__pyx_v_j]))) + __pyx_v_hsq);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line465")'> 465:                     r0 = sqrt(r0sq)</pre>
<pre id='line465' class='code' style='background-color: #FFFFff'>          __pyx_v_r0 = sqrt(__pyx_v_r0sq);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line466")'> 466:                     r0h = r0*h</pre>
<pre id='line466' class='code' style='background-color: #FFFFff'>          __pyx_v_r0h = (__pyx_v_r0 * __pyx_v_h);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line467")'> 467:                     alphabeta = alpha[i]*beta[j]</pre>
<pre id='line467' class='code' style='background-color: #FFFFff'>          __pyx_v_alphabeta = ((__pyx_v_alpha[__pyx_v_i]) * (__pyx_v_beta[__pyx_v_j]));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line468")'> 468:                     arg1 = (r0-alpha[i])/(r0+alpha[i])</pre>
<pre id='line468' class='code' style='background-color: #FFFFaa'>          __pyx_t_13 = (__pyx_v_r0 - (__pyx_v_alpha[__pyx_v_i]));
          __pyx_t_14 = (__pyx_v_r0 + (__pyx_v_alpha[__pyx_v_i]));
          if (unlikely(__pyx_t_14 == 0)) {
            #ifdef WITH_THREAD
            PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
            #endif
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
            #ifdef WITH_THREAD
            PyGILState_Release(__pyx_gilstate_save);
            #endif
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_v_arg1 = (__pyx_t_13 / __pyx_t_14);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line469")'> 469:                     arg2 = (r0-beta[j])/(r0+beta[j])</pre>
<pre id='line469' class='code' style='background-color: #FFFFaa'>          __pyx_t_14 = (__pyx_v_r0 - (__pyx_v_beta[__pyx_v_j]));
          __pyx_t_13 = (__pyx_v_r0 + (__pyx_v_beta[__pyx_v_j]));
          if (unlikely(__pyx_t_13 == 0)) {
            #ifdef WITH_THREAD
            PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
            #endif
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
            #ifdef WITH_THREAD
            PyGILState_Release(__pyx_gilstate_save);
            #endif
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_v_arg2 = (__pyx_t_14 / __pyx_t_13);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line470")'> 470:                     arg3 = alphasq+r0h+hsq</pre>
<pre id='line470' class='code' style='background-color: #FFFFff'>          __pyx_v_arg3 = ((__pyx_v_alphasq + __pyx_v_r0h) + __pyx_v_hsq);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line471")'> 471:                     arg4 = r0sq+r0h-alphasq</pre>
<pre id='line471' class='code' style='background-color: #FFFFff'>          __pyx_v_arg4 = ((__pyx_v_r0sq + __pyx_v_r0h) - __pyx_v_alphasq);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line472")'> 472:                     tlog = +fm3*log(arg1)/2. + fm2*log(arg2)/2. - fm1*log(r0+h)</pre>
<pre id='line472' class='code' style='background-color: #FFFFff'>          __pyx_v_tlog = ((((__pyx_v_fm3 * log(__pyx_v_arg1)) / 2.) + ((__pyx_v_fm2 * log(__pyx_v_arg2)) / 2.)) - (__pyx_v_fm1 * log((__pyx_v_r0 + __pyx_v_h))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line473")'> 473:                     tatan = (-fm4*atan2(alphabeta, arg3) -</pre>
<pre id='line473' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line474")'> 474:                              fm5*atan2(alphabeta, arg4) +</pre>
<pre id='line474' class='code' style='background-color: #FFFFff'>          __pyx_v_tatan = ((((-__pyx_v_fm4) * atan2(__pyx_v_alphabeta, __pyx_v_arg3)) - (__pyx_v_fm5 * atan2(__pyx_v_alphabeta, __pyx_v_arg4))) + (__pyx_v_fm6 * atan2(__pyx_v_alphabeta, __pyx_v_r0h)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line475")'> 475:                              fm6*atan2(alphabeta, r0h))</pre>
<pre id='line475' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line476")'> 476:                     t = t + sign*(tlog+tatan)</pre>
<pre id='line476' class='code' style='background-color: #FFFFff'>          __pyx_v_t = (__pyx_v_t + (__pyx_v_sign * (__pyx_v_tlog + __pyx_v_tatan)));
        }
      }
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line477")'> 477:             mval[icnt, jj, kk] = t</pre>
<pre id='line477' class='code' style='background-color: #FFFFd4'>      __pyx_t_10 = __pyx_v_icnt;
      __pyx_t_11 = __pyx_v_jj;
      __pyx_t_15 = __pyx_v_kk;
      __pyx_t_16 = -1;
      if (__pyx_t_10 &lt; 0) {
        __pyx_t_10 += __pyx_pybuffernd_mval.diminfo[0].shape;
        if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_16 = 0;
      } else if (unlikely(__pyx_t_10 &gt;= __pyx_pybuffernd_mval.diminfo[0].shape)) __pyx_t_16 = 0;
      if (__pyx_t_11 &lt; 0) {
        __pyx_t_11 += __pyx_pybuffernd_mval.diminfo[1].shape;
        if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_16 = 1;
      } else if (unlikely(__pyx_t_11 &gt;= __pyx_pybuffernd_mval.diminfo[1].shape)) __pyx_t_16 = 1;
      if (__pyx_t_15 &lt; 0) {
        __pyx_t_15 += __pyx_pybuffernd_mval.diminfo[2].shape;
        if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_16 = 2;
      } else if (unlikely(__pyx_t_15 &gt;= __pyx_pybuffernd_mval.diminfo[2].shape)) __pyx_t_16 = 2;
      if (unlikely(__pyx_t_16 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_16);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 477; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      *__Pyx_BufPtrStrided3d(double *, __pyx_pybuffernd_mval.rcbuffer-&gt;pybuffer.buf, __pyx_t_10, __pyx_pybuffernd_mval.diminfo[0].strides, __pyx_t_11, __pyx_pybuffernd_mval.diminfo[1].strides, __pyx_t_15, __pyx_pybuffernd_mval.diminfo[2].strides) = __pyx_v_t;
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line478")'> 478: </pre>
<pre id='line478' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line479")'> 479: </pre>
<pre id='line479' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line480")'> 480: ##def gm3dbig(int npro, int nstn, int Ncor, int Nf, float dens, float depth,</pre>
<pre id='line480' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line481")'> 481: ##         np.ndarray[DTYPED_t, ndim=2] X,</pre>
<pre id='line481' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line482")'> 482: ##         np.ndarray[DTYPED_t, ndim=2] Y,</pre>
<pre id='line482' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line483")'> 483: ##         np.ndarray[DTYPED_t, ndim=2] Edge,</pre>
<pre id='line483' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line484")'> 484: ##         np.ndarray[DTYPED_t, ndim=2] Corner,</pre>
<pre id='line484' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line485")'> 485: ##         np.ndarray[DTYPEI_t, ndim=2] Face,</pre>
<pre id='line485' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line486")'> 486: ##         np.ndarray[DTYPED_t, ndim=2] Gx,</pre>
<pre id='line486' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line487")'> 487: ##         np.ndarray[DTYPED_t, ndim=2] Gy,</pre>
<pre id='line487' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line488")'> 488: ##         np.ndarray[DTYPED_t, ndim=2] Gz,</pre>
<pre id='line488' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line489")'> 489: ##         np.ndarray[DTYPED_t, ndim=2] Hx,</pre>
<pre id='line489' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line490")'> 490: ##         np.ndarray[DTYPED_t, ndim=2] Hy,</pre>
<pre id='line490' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line491")'> 491: ##         np.ndarray[DTYPED_t, ndim=2] Hz,</pre>
<pre id='line491' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line492")'> 492: ##         np.ndarray[DTYPED_t, ndim=1] Pd,</pre>
<pre id='line492' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line493")'> 493: ##         np.ndarray[DTYPED_t, ndim=2] Un):</pre>
<pre id='line493' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line494")'> 494: ##    """ grvmag 3d """</pre>
<pre id='line494' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line495")'> 495: ##</pre>
<pre id='line495' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line496")'> 496: ##    cdef np.ndarray[DTYPED_t, ndim=2] cor</pre>
<pre id='line496' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line497")'> 497: ##    cdef np.ndarray[DTYPED_t, ndim=2] crs</pre>
<pre id='line497' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line498")'> 498: ##    cdef np.ndarray[DTYPED_t, ndim=1] opt</pre>
<pre id='line498' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line499")'> 499: ##    cdef np.ndarray[DTYPED_t, ndim=1] p1</pre>
<pre id='line499' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line500")'> 500: ##    cdef np.ndarray[DTYPED_t, ndim=1] p2</pre>
<pre id='line500' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line501")'> 501: ##    cdef np.ndarray[DTYPED_t, ndim=1] p3</pre>
<pre id='line501' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line502")'> 502: ##    cdef np.ndarray[DTYPED_t, ndim=1] V</pre>
<pre id='line502' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line503")'> 503: ##    cdef np.ndarray[DTYPED_t, ndim=1] pqr</pre>
<pre id='line503' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line504")'> 504: ##    cdef int t</pre>
<pre id='line504' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line505")'> 505: ##    cdef int f</pre>
<pre id='line505' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line506")'> 506: ##    cdef int Eno</pre>
<pre id='line506' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line507")'> 507: ##    cdef float flimit</pre>
<pre id='line507' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line508")'> 508: ##    cdef float normp1</pre>
<pre id='line508' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line509")'> 509: ##    cdef float normp2</pre>
<pre id='line509' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line510")'> 510: ##    cdef float gmtf1</pre>
<pre id='line510' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line511")'> 511: ##    cdef float gmtf2</pre>
<pre id='line511' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line512")'> 512: ##    cdef float gmtf3</pre>
<pre id='line512' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line513")'> 513: ##    cdef float Omega</pre>
<pre id='line513' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line514")'> 514: ##    cdef float W</pre>
<pre id='line514' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line515")'> 515: ##    cdef float l</pre>
<pre id='line515' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line516")'> 516: ##    cdef float m</pre>
<pre id='line516' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line517")'> 517: ##    cdef float n</pre>
<pre id='line517' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line518")'> 518: ##    cdef float p</pre>
<pre id='line518' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line519")'> 519: ##    cdef float q</pre>
<pre id='line519' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line520")'> 520: ##    cdef float r</pre>
<pre id='line520' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line521")'> 521: ##    cdef float fsign</pre>
<pre id='line521' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line522")'> 522: ##    cdef int pr</pre>
<pre id='line522' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line523")'> 523: ##    cdef int st</pre>
<pre id='line523' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line524")'> 524: ##</pre>
<pre id='line524' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line525")'> 525: ##    flimit = 64*np.spacing(1)</pre>
<pre id='line525' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line526")'> 526: ##</pre>
<pre id='line526' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line527")'> 527: ##    for pr in range(npro):</pre>
<pre id='line527' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line528")'> 528: ##        for st in range(nstn):</pre>
<pre id='line528' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line529")'> 529: ##            opt = np.array([X[pr, st], Y[pr, st], -depth])</pre>
<pre id='line529' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line530")'> 530: ##            cor = Corner-opt # shift origin</pre>
<pre id='line530' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line531")'> 531: ##            Edge[:, 4:6] = 0  # clear record of integration</pre>
<pre id='line531' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line532")'> 532: ##            for f in range(Nf):</pre>
<pre id='line532' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line533")'> 533: ##                nsides = Face[f, 0]</pre>
<pre id='line533' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line534")'> 534: ##                cors = Face[f, 1:nsides+1]</pre>
<pre id='line534' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line535")'> 535: ##                indx = list(range(nsides))+[0, 1]</pre>
<pre id='line535' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line536")'> 536: ##                crs = cor[cors]</pre>
<pre id='line536' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line537")'> 537: ##                fsign = np.sign(np.dot(Un[f], crs[0]))</pre>
<pre id='line537' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line538")'> 538: ##                dp1 = np.dot(crs[indx[0]], Un[f])</pre>
<pre id='line538' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line539")'> 539: ##                if abs(dp1) &lt;= flimit:</pre>
<pre id='line539' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line540")'> 540: ##                    Omega = 0.0</pre>
<pre id='line540' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line541")'> 541: ##                else:</pre>
<pre id='line541' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line542")'> 542: ##                    W = 0</pre>
<pre id='line542' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line543")'> 543: ##                    for t in range(nsides):</pre>
<pre id='line543' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line544")'> 544: ##                        p1 = crs[indx[t]]</pre>
<pre id='line544' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line545")'> 545: ##                        p2 = crs[indx[t+1]]</pre>
<pre id='line545' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line546")'> 546: ##                        p3 = crs[indx[t+2]]</pre>
<pre id='line546' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line547")'> 547: ##                        W = W + angle(p1, p2, p3, Un[f], flimit)</pre>
<pre id='line547' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line548")'> 548: ##                    W = W-(nsides-2)*pi</pre>
<pre id='line548' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line549")'> 549: ##                    Omega = -fsign*W</pre>
<pre id='line549' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line550")'> 550: ##        #       Integrate over each side if not done and save result</pre>
<pre id='line550' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line551")'> 551: ##                PQR = np.array([0, 0, 0])</pre>
<pre id='line551' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line552")'> 552: ##                for t in range(nsides):</pre>
<pre id='line552' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line553")'> 553: ##                    p1 = crs[indx[t]]</pre>
<pre id='line553' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line554")'> 554: ##                    p2 = crs[indx[t+1]]</pre>
<pre id='line554' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line555")'> 555: ##                    Eno = np.sum(Face[0:f, 0])+t   # Edge no</pre>
<pre id='line555' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line556")'> 556: ##                    V = Edge[Eno, 0:3]</pre>
<pre id='line556' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line557")'> 557: ##                    if Edge[Eno, 5] == 1:       # already done</pre>
<pre id='line557' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line558")'> 558: ##                        I = Edge[Eno, 4]</pre>
<pre id='line558' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line559")'> 559: ##                    if Edge[Eno, 5] != 1:       # not already done</pre>
<pre id='line559' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line560")'> 560: ##                        normp1 = sqrt(p1[0]**2+p1[1]**2+p1[2]**2)</pre>
<pre id='line560' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line561")'> 561: ##                        normp2 = sqrt(p2[0]**2+p2[1]**2+p2[2]**2)</pre>
<pre id='line561' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line562")'> 562: ##                        if np.dot(p1, p2)/(normp1*normp2) == 1:</pre>
<pre id='line562' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line563")'> 563: ##        # origin, p1 and  p2 are on a straight line</pre>
<pre id='line563' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line564")'> 564: ##                            if normp1 &gt; normp2:    # and p1 further than p2</pre>
<pre id='line564' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line565")'> 565: ##                                p1, p2 = p2, p1</pre>
<pre id='line565' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line566")'> 566: ##                        L = Edge[Eno, 3]</pre>
<pre id='line566' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line567")'> 567: ##                        normp1 = sqrt(p1[0]**2+p1[1]**2+p1[2]**2)</pre>
<pre id='line567' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line568")'> 568: ##                        normp2 = sqrt(p2[0]**2+p2[1]**2+p2[2]**2)</pre>
<pre id='line568' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line569")'> 569: ##                        r1 = normp1</pre>
<pre id='line569' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line570")'> 570: ##                        r2 = normp2</pre>
<pre id='line570' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line571")'> 571: ##                        I = (1/L)*log((r1+r2+L)/(r1+r2-L))  # mod. formula</pre>
<pre id='line571' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line572")'> 572: ##        #              Save edge integrals and mark as done</pre>
<pre id='line572' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line573")'> 573: ##                        s = np.nonzero(</pre>
<pre id='line573' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line574")'> 574: ##                            np.logical_and(Edge[:, 6] == Edge[Eno, 7],</pre>
<pre id='line574' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line575")'> 575: ##                                           Edge[:, 7] == Edge[Eno, 6]))</pre>
<pre id='line575' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line576")'> 576: ##                        Edge[Eno, 4] = I</pre>
<pre id='line576' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line577")'> 577: ##                        Edge[s, 4] = I</pre>
<pre id='line577' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line578")'> 578: ##                        Edge[Eno, 5] = 1</pre>
<pre id='line578' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line579")'> 579: ##                        Edge[s, 5] = 1</pre>
<pre id='line579' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line580")'> 580: ##                    pqr = I*V</pre>
<pre id='line580' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line581")'> 581: ##                    PQR = PQR+pqr</pre>
<pre id='line581' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line582")'> 582: ##</pre>
<pre id='line582' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line583")'> 583: ##        #       From Omega, l, m, n PQR get components of field due to face f</pre>
<pre id='line583' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line584")'> 584: ##                l, m, n = Un[f]</pre>
<pre id='line584' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line585")'> 585: ##                p, q, r = PQR</pre>
<pre id='line585' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line586")'> 586: ##</pre>
<pre id='line586' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line587")'> 587: ##                gmtf1 = (l*Omega+n*q-m*r)</pre>
<pre id='line587' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line588")'> 588: ##                gmtf2 = (m*Omega+l*r-n*p)</pre>
<pre id='line588' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line589")'> 589: ##                gmtf3 = (n*Omega+m*p-l*q)</pre>
<pre id='line589' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line590")'> 590: ##</pre>
<pre id='line590' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line591")'> 591: ##                Hx[pr, st] = Hx[pr, st]+Pd[f]*gmtf1</pre>
<pre id='line591' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line592")'> 592: ##                Hy[pr, st] = Hy[pr, st]+Pd[f]*gmtf2</pre>
<pre id='line592' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line593")'> 593: ##                Hz[pr, st] = Hz[pr, st]+Pd[f]*gmtf3</pre>
<pre id='line593' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line594")'> 594: ##</pre>
<pre id='line594' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line595")'> 595: ##                Gx[pr, st] = Gx[pr, st]-dens*Gc*dp1 * gmtf1</pre>
<pre id='line595' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line596")'> 596: ##                Gy[pr, st] = Gy[pr, st]-dens*Gc*dp1 * gmtf2</pre>
<pre id='line596' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line597")'> 597: ##                Gz[pr, st] = Gz[pr, st]-dens*Gc*dp1 * gmtf3</pre>
<pre id='line597' class='code' style='background-color: #FFFFff'></pre></body></html>
